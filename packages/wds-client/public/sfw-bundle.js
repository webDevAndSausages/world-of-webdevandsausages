!function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t()}function i(){return Object.create(null)}function o(t){t.forEach(r)}function a(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function u(t,e){return t!=t?e==e:t!==e}function c(t,e,n){const r=e.subscribe(n);t.$$.on_destroy.push(r.unsubscribe?()=>r.unsubscribe():r)}function h(t,e,n){if(t){const r=l(t,e,n);return t[0](r)}}function l(t,e,r){return t[1]?n({},n(e.$$scope.ctx,t[1](r?r(e):{}))):e.$$scope.ctx}function f(t,e,r,i){return t[1]?n({},n(e.$$scope.changed||{},t[1](i?i(r):{}))):e.$$scope.changed||{}}const p=new Set;let d,m=!1;function y(){p.forEach(t=>{t[0](window.performance.now())||(p.delete(t),t[1]())}),(m=p.size>0)&&requestAnimationFrame(y)}function g(t){let e;return m||(m=!0,requestAnimationFrame(y)),{promise:new Promise(n=>{p.add(e=[t,n])}),abort(){p.delete(e)}}}function v(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n)}function w(t){t.parentNode.removeChild(t)}function S(t){return document.createElement(t)}function E(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function I(){return T(" ")}function C(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function D(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function A(t,e,n){t.classList[n?"add":"remove"](e)}let N,k=0,O={};function _(t,e,n,r,i,o,a,s=0){const u=16.666/r;let c="{\n";for(let t=0;t<=1;t+=u){const r=e+(n-e)*o(t);c+=100*t+`%{${a(r,1-r)}}\n`}const h=c+`100% {${a(n,1-n)}}\n}`,l=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(h)}_${s}`;if(!O[l]){if(!d){const t=S("style");document.head.appendChild(t),d=t.sheet}O[l]=!0,d.insertRule(`@keyframes ${l} ${h}`,d.cssRules.length)}const f=t.style.animation||"";return t.style.animation=`${f?`${f}, `:""}${l} ${r}ms linear ${i}ms 1 both`,k+=1,l}function R(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--k&&requestAnimationFrame(()=>{if(k)return;let t=d.cssRules.length;for(;t--;)d.deleteRule(t);O={}})}function M(t){N=t}function P(t){(function(){if(!N)throw new Error("Function called outside component initialization");return N})().$$.on_mount.push(t)}const x=[],L=Promise.resolve();let F=!1;const q=[],B=[],V=[];function U(t){B.push(t)}function j(){const t=new Set;do{for(;x.length;){const t=x.shift();M(t),Q(t.$$)}for(;q.length;)q.shift()();for(;B.length;){const e=B.pop();t.has(e)||(e(),t.add(e))}}while(x.length);for(;V.length;)V.pop()();F=!1}function Q(t){t.fragment&&(t.update(t.dirty),o(t.before_render),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_render.forEach(U))}let K,G;function W(){return K||(K=Promise.resolve()).then(()=>{K=null}),K}function z(){G={remaining:0,callbacks:[]}}function $(){G.remaining||o(G.callbacks)}function H(t){G.callbacks.push(t)}function Y(n,r,i){let o,a,s=r(n,i),u=!1,c=0;function h(){o&&R(n,o)}function l(){const{delay:r=0,duration:i=300,easing:l=e,tick:f=t,css:p}=s;p&&(o=_(n,0,1,i,r,l,p,c++)),f(0,1);const d=window.performance.now()+r,m=d+i;a&&a.abort(),u=!0,a=g(t=>{if(u){if(t>=m)return f(1,0),h(),u=!1;if(t>=d){const e=l((t-d)/i);f(e,1-e)}}return u})}let f=!1;return{start(){f||(R(n),"function"==typeof s?(s=s(),W().then(l)):l())},invalidate(){f=!1},end(){u&&(h(),u=!1)}}}function X(t,e,n){const{fragment:i,on_mount:s,on_destroy:u,after_render:c}=t.$$;i.m(e,n),U(()=>{const e=s.map(r).filter(a);u?u.push(...e):o(e),t.$$.on_mount=[]}),c.forEach(U)}function J(t,e){t.$$.dirty||(x.push(t),F||(F=!0,L.then(j)),t.$$.dirty={}),t.$$.dirty[e]=!0}function Z(e,n,r,a,s,u){const c=N;M(e);const h=n.props||{},l=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(c?c.$$.context:[]),callbacks:i(),dirty:null};let f=!1;var p;l.ctx=r?r(e,h,(t,n)=>{l.ctx&&s(l.ctx[t],l.ctx[t]=n)&&(l.bound[t]&&l.bound[t](n),f&&J(e,t))}):h,l.update(),f=!0,o(l.before_render),l.fragment=a(l.ctx),n.target&&(n.hydrate?l.fragment.l((p=n.target,Array.from(p.childNodes))):l.fragment.c(),n.intro&&e.$$.fragment.i&&e.$$.fragment.i(),X(e,n.target,n.anchor),j()),M(c)}class tt{$destroy(){var e,n;n=!0,(e=this).$$&&(o(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function et(t){var e=t-1;return e*e*e+1}function nt(t,{delay:e=0,duration:n=400}){const r=+getComputedStyle(t).opacity;return{delay:e,duration:n,css:t=>`opacity: ${t*r}`}}function rt(t,{delay:e=0,duration:n=400,easing:r=et,x:i=0,y:o=0,opacity:a=0}){const s=getComputedStyle(t),u=+s.opacity,c="none"===s.transform?"":s.transform,h=u*(1-a);return{delay:e,duration:n,easing:r,css:(t,e)=>`\n\t\t\ttransform: ${c} translate(${(1-t)*i}px, ${(1-t)*o}px);\n\t\t\topacity: ${u-h*e}`}}function it(e,n=t){let r;const i=[];function o(t){if(s(e,t)){if(e=t,!r)return;i.forEach(t=>t[1]()),i.forEach(t=>t[0](e))}}return{set:o,update:function(t){o(t(e))},subscribe:function(a,s=t){const u=[a,s];return i.push(u),1===i.length&&(r=n(o)||t),a(e),()=>{const t=i.indexOf(u);-1!==t&&i.splice(t,1),0===i.length&&r()}}}}const ot=t=>t&&void 0!==t,at=ot(window),st="__$site-feedback-widget";var ut=((t=window.localStorage)=>({get(e=null){if(!at)return e;const n=t[st],r=t[`${st}-expiration`];return ot(n)&&!ot(r)||"done"===n?n:ot(n)&&+new Date<Number(r)?n:(this.remove(),e)},set(e,n=function(){let t=Date.now();return+new Date(t+=2592e5)}()){(at||hasWindow)&&(t[st]=e,t[`${st}-expiration`]=n)},remove(){delete t[st],delete t[`${st}-expiration`]}}))();const ct={rating:0,text:"",current:"idle",submitting:!1,init:!1};function ht(t,e){switch(e.current){case"idle":switch(t.type){case"SHOW":return{...e,current:"star-rating",init:!0,event:t.type};default:return e}case"star-rating":switch(t.type){case"RATE":return t.payload<=3?{...e,rating:t.payload,current:"form",event:t.type}:{...e,rating:t.payload,current:"thanks",event:t.type};case"CLOSE":return{...ct,event:t.type};default:return e}case"form":switch(t.type){case"SUBMIT":return{...e,text:t.payload,submitting:!0,event:t.type};case"FINISH":return{...e,result:t.payload,current:"thanks",event:t.type};case"CLOSE":return{...ct,event:t.type};default:return e}case"thanks":switch(t.type){case"CLOSE":return{...ct,event:t.type};default:return e}default:return e}}const lt=function(t,e){const n=it(e),r=Object.keys(t).reduce((e,r)=>(e[r]=(e=>n.update(n=>t[r](e,n))),e),{});return{subscribe:n.subscribe,actions:r}}({show:(t,e)=>ht({type:"SHOW"},e),rate:(t,e)=>ht({type:"RATE",payload:t},e),close:(t,e)=>ht({type:"CLOSE"},e),submit:(t,e)=>ht({type:"SUBMIT",payload:t},e),finish:(t,e)=>ht({type:"FINISH",payload:t},e)},ct),ft=function(t,e,n){const r=!Array.isArray(t);r&&(t=[t]);const i=e.length<2;let a={};return function(t,e){return{subscribe:it(t,e).subscribe}}(n,n=>{let s=!1;const u=[];let c=0;const h=()=>{if(c)return;const t=e(r?u[0]:u,n);i&&a!==(a=t)&&n(t)},l=t.map((t,e)=>t.subscribe(t=>{u[e]=t,c&=~(1<<e),s&&h()},()=>{c|=1<<e}));return s=!0,h(),function(){o(l)}})}(lt,t=>{"rate"===t.current&&t.rating>0?ut.set("done"):t.init&&ut.set("seen");const e=ut.get();return"done"===e||"seen"===e});function pt(t){var e,n,r;return{c(){e=E("svg"),n=E("line"),r=E("line"),D(n,"x1","18"),D(n,"y1","6"),D(n,"x2","6"),D(n,"y2","18"),D(r,"x1","6"),D(r,"y1","6"),D(r,"x2","18"),D(r,"y2","18"),D(e,"xmlns","http://www.w3.org/2000/svg"),D(e,"width","18"),D(e,"height","18"),D(e,"viewBox","0 0 24 24"),D(e,"fill","none"),D(e,"stroke","currentColor"),D(e,"stroke-width","2"),D(e,"stroke-linecap","round"),D(e,"stroke-linejoin","round"),D(e,"class","feather feather-x svelte-1kdhtly")},m(t,i){b(t,e,i),v(e,n),v(e,r)},d(t){t&&w(e)}}}function dt(t){var e,n;return{c(){e=E("svg"),D(n=E("polyline"),"points","18 15 12 9 6 15"),D(e,"xmlns","http://www.w3.org/2000/svg"),D(e,"width","18"),D(e,"height","18"),D(e,"viewBox","0 0 24 24"),D(e,"fill","none"),D(e,"stroke","currentColor"),D(e,"stroke-width","2"),D(e,"stroke-linecap","round"),D(e,"stroke-linejoin","round"),D(e,"class","feather feather-chevron-up svelte-1kdhtly")},m(t,r){b(t,e,r),v(e,n)},d(t){t&&w(e)}}}function mt(e){var n,r,i;function o(t){return t.collapsed?dt:pt}var a=o(e),s=a(e);return{c(){n=S("div"),r=T("Feedback "),s.c(),n.className="open-close-tab svelte-1kdhtly",A(n,"tab-collapsed",e.collapsed),A(n,"tab-open",!e.collapsed),i=C(n,"click",e.onClick)},m(t,e){b(t,n,e),v(n,r),s.m(n,null)},p(t,e){a!==(a=o(e))&&(s.d(1),(s=a(e))&&(s.c(),s.m(n,null))),t.collapsed&&(A(n,"tab-collapsed",e.collapsed),A(n,"tab-open",!e.collapsed))},i:t,o:t,d(t){t&&w(n),s.d(),i()}}}function yt(t,e,n){let r;c(t,lt,t=>{n("$store",r=t)});let i="idle"===r.current;return{collapsed:i,onClick:function(){return i?lt.actions.show():lt.actions.close()}}}class gt extends tt{constructor(t){super(),Z(this,t,yt,mt,s,[])}}const vt=({})=>({}),bt=({})=>({});function wt(n){var r,i,a,s,u,c,p,d,m,y,E=new gt({});const T=n.$$slots.header,C=h(T,n,bt),D=n.$$slots.default,A=h(D,n,null);return{c(){r=S("div"),E.$$.fragment.c(),i=I(),a=S("header"),C&&C.c(),s=I(),u=S("main"),A&&A.c(),c=I(),(p=S("footer")).innerHTML='<a href="https://github.com/webDevAndSausages/world-of-webdevandsausages" target="_blank" rel="noopener noreferrer">\n\t\t\t      Make an issue on Github\n\t\t\t    </a>',a.className="svelte-1j5vtvk",u.className="svelte-1j5vtvk",p.className="svelte-1j5vtvk",r.className="svelte-1j5vtvk"},l(t){C&&C.l(header_nodes),A&&A.l(main_nodes)},m(t,e){b(t,r,e),X(E,r,null),v(r,i),v(r,a),C&&C.m(a,null),v(r,s),v(r,u),A&&A.m(u,null),v(r,c),v(r,p),y=!0},p(t,e){C&&C.p&&t.$$scope&&C.p(f(T,e,t,vt),l(T,e,bt)),A&&A.p&&t.$$scope&&A.p(f(D,e,t),l(D,e,null))},i(t){y||(E.$$.fragment.i(t),C&&C.i&&C.i(t),A&&A.i&&A.i(t),U(()=>{m&&m.end(1),d||(d=Y(r,rt,{y:200,duration:1e3})),d.start()}),y=!0)},o(n){E.$$.fragment.o(n),C&&C.o&&C.o(n),A&&A.o&&A.o(n),d&&d.invalidate(),n&&(m=function(n,r,i){let a,s=r(n,i),u=!0;const c=G;function h(){const{delay:r=0,duration:i=300,easing:h=e,tick:l=t,css:f}=s;f&&(a=_(n,1,0,i,r,h,f));const p=window.performance.now()+r,d=p+i;g(t=>{if(u){if(t>=d)return l(0,1),--c.remaining||o(c.callbacks),!1;if(t>=p){const e=h((t-p)/i);l(1-e,e)}}return u})}return c.remaining+=1,"function"==typeof s?W().then(()=>{s=s(),h()}):h(),{end(t){t&&s.tick&&s.tick(1,0),u&&(a&&R(n,a),u=!1)}}}(r,rt,{y:200,duration:500})),y=!1},d(t){t&&w(r),E.$destroy(),C&&C.d(t),A&&A.d(t),t&&m&&m.end()}}}function St(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$set=(t=>{"$$scope"in t&&n("$$scope",i=t.$$scope)}),{$$slots:r,$$scope:i}}class Et extends tt{constructor(t){super(),Z(this,t,St,wt,s,[])}}!function(t){if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};h.prototype.append=function(t,e){t=s(t),e=u(e);var n=this.map[t];this.map[t]=n?n+","+e:e},h.prototype.delete=function(t){delete this.map[s(t)]},h.prototype.get=function(t){return t=s(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(s(t))},h.prototype.set=function(t,e){this.map[s(t)]=u(e)},h.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},h.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),c(t)},h.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),c(t)},h.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),c(t)},e.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},m.call(y.prototype),m.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var a=[301,302,303,307,308];v.redirect=function(t,e){if(-1===a.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},t.Headers=h,t.Request=y,t.Response=v,t.fetch=function(t,n){return new Promise(function(r,i){var o=new y(t,n),a=new XMLHttpRequest;a.onload=function(){var t,e,n={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;r(new v(i,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&e.blob&&(a.responseType="blob"),o.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function s(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function u(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(n[Symbol.iterator]=function(){return n}),n}function h(t){this.map={},t instanceof h?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function f(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function p(t){var e=new FileReader,n=f(e);return e.readAsArrayBuffer(t),n}function d(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&r(t))this._bodyArrayBuffer=d(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?l(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,n,r=l(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=f(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(t,e){var n,r,i=(e=e||{}).body;if(t instanceof y){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function g(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function v(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var Tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function It(t,e){return t(e={exports:{}},e.exports),e.exports}function Ct(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}var Dt=setTimeout;function At(){}function Nt(t){if(!(this instanceof Nt))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],Pt(t,this)}function kt(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,Nt._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void _t(e.promise,t)}Ot(e.promise,r)}else(1===t._state?Ot:_t)(e.promise,t._value)})):t._deferreds.push(e)}function Ot(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof Nt)return t._state=3,t._value=e,void Rt(t);if("function"==typeof n)return void Pt((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,Rt(t)}catch(e){_t(t,e)}var r,i}function _t(t,e){t._state=2,t._value=e,Rt(t)}function Rt(t){2===t._state&&0===t._deferreds.length&&Nt._immediateFn(function(){t._handled||Nt._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)kt(t,t._deferreds[e]);t._deferreds=null}function Mt(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function Pt(t,e){var n=!1;try{t(function(t){n||(n=!0,Ot(e,t))},function(t){n||(n=!0,_t(e,t))})}catch(t){if(n)return;n=!0,_t(e,t)}}Nt.prototype.catch=function(t){return this.then(null,t)},Nt.prototype.then=function(t,e){var n=new this.constructor(At);return kt(this,new Mt(t,e,n)),n},Nt.prototype.finally=Ct,Nt.all=function(t){return new Nt(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){o(t,e)},n)}r[t]=a,0==--i&&e(r)}catch(t){n(t)}}for(var a=0;a<r.length;a++)o(a,r[a])})},Nt.resolve=function(t){return t&&"object"==typeof t&&t.constructor===Nt?t:new Nt(function(e){e(t)})},Nt.reject=function(t){return new Nt(function(e,n){n(t)})},Nt.race=function(t){return new Nt(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},Nt._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){Dt(t,0)},Nt._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var xt=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==Tt)return Tt;throw new Error("unable to locate global object")}();"Promise"in xt?xt.Promise.prototype.finally||(xt.Promise.prototype.finally=Ct):xt.Promise=Nt;var Lt,Ft,qt,Bt=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function")}(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},Vt=function(t){try{return!!t()}catch(t){return!0}},Ut={}.toString,jt=function(t){return Ut.call(t).slice(8,-1)},Qt="".split,Kt=Vt(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==jt(t)?Qt.call(t,""):Object(t)}:Object,Gt=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},Wt=function(t){return Object(Gt(t))},zt=Math.ceil,$t=Math.floor,Ht=function(t){return isNaN(t=+t)?0:(t>0?$t:zt)(t)},Yt=Math.min,Xt=function(t){return t>0?Yt(Ht(t),9007199254740991):0},Jt=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Zt=Array.isArray||function(t){return"Array"==jt(t)},te="object"==typeof window&&window&&window.Math==Math?window:"object"==typeof self&&self&&self.Math==Math?self:Function("return this")(),ee=!Vt(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),ne=te.document,re=Jt(ne)&&Jt(ne.createElement),ie=function(t){return re?ne.createElement(t):{}},oe=!ee&&!Vt(function(){return 7!=Object.defineProperty(ie("div"),"a",{get:function(){return 7}}).a}),ae=function(t){if(!Jt(t))throw TypeError(String(t)+" is not an object");return t},se=function(t,e){if(!Jt(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!Jt(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!Jt(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!Jt(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},ue=Object.defineProperty,ce={f:ee?ue:function(t,e,n){if(ae(t),e=se(e,!0),ae(n),oe)try{return ue(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},he=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},le=ee?function(t,e,n){return ce.f(t,e,he(1,n))}:function(t,e,n){return t[e]=n,t},fe=function(t,e){try{le(te,t,e)}catch(n){te[t]=e}return e},pe=It(function(t){var e=te["__core-js_shared__"]||fe("__core-js_shared__",{});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.0.1",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),de=0,me=Math.random(),ye=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++de+me).toString(36))},ge=!Vt(function(){return!String(Symbol())}),ve=pe("wks"),be=te.Symbol,we=function(t){return ve[t]||(ve[t]=ge&&be[t]||(ge?be:ye)("Symbol."+t))},Se=we("species"),Ee=function(t,e){var n;return Zt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Zt(n.prototype)?Jt(n)&&null===(n=n[Se])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Te=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,u=e||Ee;return function(e,c,h){for(var l,f,p=Wt(e),d=Kt(p),m=Bt(c,h,3),y=Xt(d.length),g=0,v=n?u(e,y):r?u(e,0):void 0;y>g;g++)if((s||g in d)&&(f=m(l=d[g],g,p),t))if(n)v[g]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return g;case 2:v.push(l)}else if(o)return!1;return a?-1:i||o?o:v}},Ie={}.propertyIsEnumerable,Ce=Object.getOwnPropertyDescriptor,De={f:Ce&&!Ie.call({1:2},1)?function(t){var e=Ce(this,t);return!!e&&e.enumerable}:Ie},Ae=function(t){return Kt(Gt(t))},Ne={}.hasOwnProperty,ke=function(t,e){return Ne.call(t,e)},Oe=Object.getOwnPropertyDescriptor,_e={f:ee?Oe:function(t,e){if(t=Ae(t),e=se(e,!0),oe)try{return Oe(t,e)}catch(t){}if(ke(t,e))return he(!De.f.call(t,e),t[e])}},Re=pe("native-function-to-string",Function.toString),Me=te.WeakMap,Pe="function"==typeof Me&&/native code/.test(Re.call(Me)),xe=pe("keys"),Le=function(t){return xe[t]||(xe[t]=ye(t))},Fe={},qe=te.WeakMap;if(Pe){var Be=new qe,Ve=Be.get,Ue=Be.has,je=Be.set;Lt=function(t,e){return je.call(Be,t,e),e},Ft=function(t){return Ve.call(Be,t)||{}},qt=function(t){return Ue.call(Be,t)}}else{var Qe=Le("state");Fe[Qe]=!0,Lt=function(t,e){return le(t,Qe,e),e},Ft=function(t){return ke(t,Qe)?t[Qe]:{}},qt=function(t){return ke(t,Qe)}}var Ke,Ge={set:Lt,get:Ft,has:qt,enforce:function(t){return qt(t)?Ft(t):Lt(t,{})},getterFor:function(t){return function(e){var n;if(!Jt(e)||(n=Ft(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},We=It(function(t){var e=Ge.get,n=Ge.enforce,r=String(Re).split("toString");pe("inspectSource",function(t){return Re.call(t)}),(t.exports=function(t,e,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,u=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||ke(i,"name")||le(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==te?(a?!u&&t[e]&&(s=!0):delete t[e],s?t[e]=i:le(t,e,i)):s?t[e]=i:fe(e,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||Re.call(this)})}),ze=Math.max,$e=Math.min,He=(Ke=!1,function(t,e,n){var r,i=Ae(t),o=Xt(i.length),a=function(t,e){var n=Ht(t);return n<0?ze(n+e,0):$e(n,e)}(n,o);if(Ke&&e!=e){for(;o>a;)if((r=i[a++])!=r)return!0}else for(;o>a;a++)if((Ke||a in i)&&i[a]===e)return Ke||a||0;return!Ke&&-1}),Ye=function(t,e){var n,r=Ae(t),i=0,o=[];for(n in r)!ke(Fe,n)&&ke(r,n)&&o.push(n);for(;e.length>i;)ke(r,n=e[i++])&&(~He(o,n)||o.push(n));return o},Xe=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Je=Xe.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return Ye(t,Je)}},tn={f:Object.getOwnPropertySymbols},en=te.Reflect,nn=en&&en.ownKeys||function(t){var e=Ze.f(ae(t)),n=tn.f;return n?e.concat(n(t)):e},rn=function(t,e){for(var n=nn(e),r=ce.f,i=_e.f,o=0;o<n.length;o++){var a=n[o];ke(t,a)||r(t,a,i(e,a))}},on=/#|\.prototype\./,an=function(t,e){var n=un[sn(t)];return n==hn||n!=cn&&("function"==typeof e?Vt(e):!!e)},sn=an.normalize=function(t){return String(t).replace(on,".").toLowerCase()},un=an.data={},cn=an.NATIVE="N",hn=an.POLYFILL="P",ln=an,fn=_e.f,pn=function(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?te:c?te[s]||fe(s,{}):(te[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=fn(n,r))&&a.value:n[r],!ln(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;rn(o,i)}(t.sham||i&&i.sham)&&le(o,"sham",!0),We(n,r,o,t)}},dn=Object.keys||function(t){return Ye(t,Xe)},mn=ee?Object.defineProperties:function(t,e){ae(t);for(var n,r=dn(e),i=r.length,o=0;i>o;)ce.f(t,n=r[o++],e[n]);return t},yn=te.document,gn=yn&&yn.documentElement,vn=Le("IE_PROTO"),bn=function(){},wn=function(){var t,e=ie("iframe"),n=Xe.length;for(e.style.display="none",gn.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),wn=t.F;n--;)delete wn.prototype[Xe[n]];return wn()},Sn=Object.create||function(t,e){var n;return null!==t?(bn.prototype=ae(t),n=new bn,bn.prototype=null,n[vn]=t):n=wn(),void 0===e?n:mn(n,e)};Fe[vn]=!0;var En=we("unscopables"),Tn=Array.prototype;null==Tn[En]&&le(Tn,En,Sn(null));var In=function(t){Tn[En][t]=!0},Cn=Te(5),Dn=!0;"find"in[]&&Array(1).find(function(){Dn=!1}),pn({target:"Array",proto:!0,forced:Dn},{find:function(t){return Cn(this,t,arguments.length>1?arguments[1]:void 0)}}),In("find");var An=Function.call,Nn=function(t,e,n){return Bt(An,te[t].prototype[e],n)},kn=(Nn("Array","find"),Te(6)),On=!0;"findIndex"in[]&&Array(1).findIndex(function(){On=!1}),pn({target:"Array",proto:!0,forced:On},{findIndex:function(t){return kn(this,t,arguments.length>1?arguments[1]:void 0)}}),In("findIndex");Nn("Array","findIndex");var _n=Object.assign,Rn=!_n||Vt(function(){var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(t){e[t]=t}),7!=_n({},t)[n]||"abcdefghijklmnopqrst"!=dn(_n({},e)).join("")})?function(t,e){for(var n=Wt(t),r=arguments.length,i=1,o=tn.f,a=De.f;r>i;)for(var s,u=Kt(arguments[i++]),c=o?dn(u).concat(o(u)):dn(u),h=c.length,l=0;h>l;)a.call(u,s=c[l++])&&(n[s]=u[s]);return n}:_n;pn({target:"Object",stat:!0,forced:Object.assign!==Rn},{assign:Rn});var Mn=te,Pn=(Mn.Object.assign,we("match")),xn=function(t,e,n){if(Jt(r=e)&&(void 0!==(i=r[Pn])?i:"RegExp"==jt(r)))throw TypeError("String.prototype."+n+" doesn't accept regex");var r,i;return String(Gt(t))},Ln=we("match"),Fn=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Ln]=!1,"/./"[t](e)}catch(t){}}return!1}("startsWith"),qn="".startsWith;pn({target:"String",proto:!0,forced:!Fn},{startsWith:function(t){var e=xn(this,t,"startsWith"),n=Xt(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return qn?qn.call(e,r,n):e.slice(n,n+r.length)===r}});Nn("String","startsWith");pn({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(Gt(this)),n="",r=Ht(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});Nn("String","repeat");var Bn=function(t,e,n){var r=se(e);r in t?ce.f(t,r,he(0,n)):t[r]=n},Vn=we("species"),Un=we("isConcatSpreadable"),jn=!Vt(function(){var t=[];return t[Un]=!1,t.concat()[0]!==t}),Qn=function(t){return!Vt(function(){var e=[];return(e.constructor={})[Vn]=function(){return{foo:1}},1!==e[t](Boolean).foo})}("concat"),Kn=function(t){if(!Jt(t))return!1;var e=t[Un];return void 0!==e?!!e:Zt(t)};pn({target:"Array",proto:!0,forced:!jn||!Qn},{concat:function(t){var e,n,r,i,o,a=Wt(this),s=Ee(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?a:arguments[e],Kn(o)){if(u+(i=Xt(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,u++)n in o&&Bn(s,u,o[n])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Bn(s,u++,o)}return s.length=u,s}});var Gn=we("toStringTag"),Wn="Arguments"==jt(function(){return arguments}()),zn={};zn[we("toStringTag")]="z";var $n="[object z]"!==String(zn)?function(){return"[object "+(void 0===(t=this)?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Gn))?n:Wn?jt(e):"Object"==(r=jt(e))&&"function"==typeof e.callee?"Arguments":r)+"]";var t,e,n,r}:zn.toString,Hn=Object.prototype;$n!==Hn.toString&&We(Hn,"toString",$n,{unsafe:!0});var Yn=ce.f,Xn=we("toStringTag"),Jn=function(t,e,n){t&&!ke(t=n?t:t.prototype,Xn)&&Yn(t,Xn,{configurable:!0,value:e})},Zn={f:we},tr=ce.f,er=function(t){var e=Mn.Symbol||(Mn.Symbol={});ke(e,t)||tr(e,t,{value:Zn.f(t)})},nr=Ze.f,rr={}.toString,ir="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],or={f:function(t){return ir&&"[object Window]"==rr.call(t)?function(t){try{return nr(t)}catch(t){return ir.slice()}}(t):nr(Ae(t))}},ar=Le("hidden"),sr=Ge.set,ur=Ge.getterFor("Symbol"),cr=_e.f,hr=ce.f,lr=or.f,fr=te.Symbol,pr=te.JSON,dr=pr&&pr.stringify,mr=we("toPrimitive"),yr=De.f,gr=pe("symbol-registry"),vr=pe("symbols"),br=pe("op-symbols"),wr=pe("wks"),Sr=Object.prototype,Er=te.QObject,Tr=!Er||!Er.prototype||!Er.prototype.findChild,Ir=ee&&Vt(function(){return 7!=Sn(hr({},"a",{get:function(){return hr(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=cr(Sr,e);r&&delete Sr[e],hr(t,e,n),r&&t!==Sr&&hr(Sr,e,r)}:hr,Cr=function(t,e){var n=vr[t]=Sn(fr.prototype);return sr(n,{type:"Symbol",tag:t,description:e}),ee||(n.description=e),n},Dr=ge&&"symbol"==typeof fr.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof fr},Ar=function(t,e,n){return t===Sr&&Ar(br,e,n),ae(t),e=se(e,!0),ae(n),ke(vr,e)?(n.enumerable?(ke(t,ar)&&t[ar][e]&&(t[ar][e]=!1),n=Sn(n,{enumerable:he(0,!1)})):(ke(t,ar)||hr(t,ar,he(1,{})),t[ar][e]=!0),Ir(t,e,n)):hr(t,e,n)},Nr=function(t,e){ae(t);for(var n,r=function(t){var e=dn(t),n=tn.f;if(n)for(var r,i=n(t),o=De.f,a=0;i.length>a;)o.call(t,r=i[a++])&&e.push(r);return e}(e=Ae(e)),i=0,o=r.length;o>i;)Ar(t,n=r[i++],e[n]);return t},kr=function(t){var e=yr.call(this,t=se(t,!0));return!(this===Sr&&ke(vr,t)&&!ke(br,t))&&(!(e||!ke(this,t)||!ke(vr,t)||ke(this,ar)&&this[ar][t])||e)},Or=function(t,e){if(t=Ae(t),e=se(e,!0),t!==Sr||!ke(vr,e)||ke(br,e)){var n=cr(t,e);return!n||!ke(vr,e)||ke(t,ar)&&t[ar][e]||(n.enumerable=!0),n}},_r=function(t){for(var e,n=lr(Ae(t)),r=[],i=0;n.length>i;)ke(vr,e=n[i++])||ke(Fe,e)||r.push(e);return r},Rr=function(t){for(var e,n=t===Sr,r=lr(n?br:Ae(t)),i=[],o=0;r.length>o;)!ke(vr,e=r[o++])||n&&!ke(Sr,e)||i.push(vr[e]);return i};ge||(We((fr=function(){if(this instanceof fr)throw TypeError("Symbol is not a constructor");var t=void 0===arguments[0]?void 0:String(arguments[0]),e=ye(t),n=function(t){this===Sr&&n.call(br,t),ke(this,ar)&&ke(this[ar],e)&&(this[ar][e]=!1),Ir(this,e,he(1,t))};return ee&&Tr&&Ir(Sr,e,{configurable:!0,set:n}),Cr(e,t)}).prototype,"toString",function(){return ur(this).tag}),De.f=kr,ce.f=Ar,_e.f=Or,Ze.f=or.f=_r,tn.f=Rr,ee&&(hr(fr.prototype,"description",{configurable:!0,get:function(){return ur(this).description}}),We(Sr,"propertyIsEnumerable",kr,{unsafe:!0})),Zn.f=function(t){return Cr(we(t),t)}),pn({global:!0,wrap:!0,forced:!ge,sham:!ge},{Symbol:fr});for(var Mr=dn(wr),Pr=0;Mr.length>Pr;)er(Mr[Pr++]);pn({target:"Symbol",stat:!0,forced:!ge},{for:function(t){return ke(gr,t+="")?gr[t]:gr[t]=fr(t)},keyFor:function(t){if(!Dr(t))throw TypeError(t+" is not a symbol");for(var e in gr)if(gr[e]===t)return e},useSetter:function(){Tr=!0},useSimple:function(){Tr=!1}}),pn({target:"Object",stat:!0,forced:!ge,sham:!ee},{create:function(t,e){return void 0===e?Sn(t):Nr(Sn(t),e)},defineProperty:Ar,defineProperties:Nr,getOwnPropertyDescriptor:Or}),pn({target:"Object",stat:!0,forced:!ge},{getOwnPropertyNames:_r,getOwnPropertySymbols:Rr}),pr&&pn({target:"JSON",stat:!0,forced:!ge||Vt(function(){var t=fr();return"[null]"!=dr([t])||"{}"!=dr({a:t})||"{}"!=dr(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(Jt(e)||void 0!==t)&&!Dr(t))return Zt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Dr(e))return e}),r[1]=e,dr.apply(pr,r)}}),fr.prototype[mr]||le(fr.prototype,mr,fr.prototype.valueOf),Jn(fr,"Symbol"),Fe[ar]=!0,er("asyncIterator");var xr=ce.f,Lr=te.Symbol;if(ee&&"function"==typeof Lr&&(!("description"in Lr.prototype)||void 0!==Lr().description)){var Fr={},qr=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof qr?new Lr(t):void 0===t?Lr():Lr(t);return""===t&&(Fr[e]=!0),e};rn(qr,Lr);var Br=qr.prototype=Lr.prototype;Br.constructor=qr;var Vr=Br.toString,Ur="Symbol(test)"==String(Lr("test")),jr=/^Symbol\((.*)\)[^)]+$/;xr(Br,"description",{configurable:!0,get:function(){var t=Jt(this)?this.valueOf():this,e=Vr.call(t);if(ke(Fr,t))return"";var n=Ur?e.slice(7,-1):e.replace(jr,"$1");return""===n?void 0:n}}),pn({global:!0,forced:!0},{Symbol:qr})}er("hasInstance"),er("isConcatSpreadable"),er("iterator"),er("match"),er("replace"),er("search"),er("species"),er("split"),er("toPrimitive"),er("toStringTag"),er("unscopables"),Jn(Math,"Math",!0),Jn(te.JSON,"JSON",!0);Mn.Symbol;er("dispose"),er("observable"),er("patternMatch");var Qr,Kr,Gr,Wr=!Vt(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),zr=Le("IE_PROTO"),$r=Object.prototype,Hr=Wr?Object.getPrototypeOf:function(t){return t=Wt(t),ke(t,zr)?t[zr]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?$r:null},Yr=we("iterator"),Xr=!1;[].keys&&("next"in(Gr=[].keys())?(Kr=Hr(Hr(Gr)))!==Object.prototype&&(Qr=Kr):Xr=!0),null==Qr&&(Qr={}),ke(Qr,Yr)||le(Qr,Yr,function(){return this});var Jr={IteratorPrototype:Qr,BUGGY_SAFARI_ITERATORS:Xr},Zr=Jr.IteratorPrototype,ti=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return function(t,e){if(ae(t),!Jt(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(n,r),e?t.call(n,r):n.__proto__=r,n}}():void 0),ei=we("iterator"),ni=Jr.IteratorPrototype,ri=Jr.BUGGY_SAFARI_ITERATORS,ii=function(){return this},oi=function(t,e,n,r,i,o,a){!function(t,e,n){var r=e+" Iterator";t.prototype=Sn(Zr,{next:he(1,n)}),Jn(t,r,!1)}(n,e,r);var s,u,c,h=function(t){if(t===i&&m)return m;if(!ri&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},l=e+" Iterator",f=!1,p=t.prototype,d=p[ei]||p["@@iterator"]||i&&p[i],m=!ri&&d||h(i),y="Array"==e&&p.entries||d;if(y&&(s=Hr(y.call(new t)),ni!==Object.prototype&&s.next&&(Hr(s)!==ni&&(ti?ti(s,ni):"function"!=typeof s[ei]&&le(s,ei,ii)),Jn(s,l,!0))),"values"==i&&d&&"values"!==d.name&&(f=!0,m=function(){return d.call(this)}),p[ei]!==m&&le(p,ei,m),i)if(u={values:h("values"),keys:o?m:h("keys"),entries:h("entries")},a)for(c in u)!ri&&!f&&c in p||We(p,c,u[c]);else pn({target:e,proto:!0,forced:ri||f},u);return u},ai=Ge.set,si=Ge.getterFor("String Iterator");oi(String,"String",function(t){ai(this,{type:"String Iterator",string:String(t),index:0})},function(){var t,e,n,r,i,o,a,s,u=si(this),c=u.string,h=u.index;return h>=c.length?{value:void 0,done:!0}:(e=h,n=!0,o=String(Gt(c)),a=Ht(e),s=o.length,t=a<0||a>=s?n?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?n?o.charAt(a):r:n?o.slice(a,a+2):i-56320+(r-55296<<10)+65536,u.index+=t.length,{value:t,done:!1})});var ui={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ci=Ge.set,hi=Ge.getterFor("Array Iterator"),li=oi(Array,"Array",function(t,e){ci(this,{type:"Array Iterator",target:Ae(t),index:0,kind:e})},function(){var t=hi(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");In("keys"),In("values"),In("entries");var fi=we("iterator"),pi=we("toStringTag"),di=li.values;for(var mi in ui){var yi=te[mi],gi=yi&&yi.prototype;if(gi){if(gi[fi]!==di)try{le(gi,fi,di)}catch(Li){gi[fi]=di}if(gi[pi]||le(gi,pi,mi),ui[mi])for(var vi in li)if(gi[vi]!==li[vi])try{le(gi,vi,li[vi])}catch(Li){gi[vi]=li[vi]}}}Zn.f("iterator");var bi=function(t,e){return(bi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function wi(t,e){function n(){this.constructor=t}bi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Si=function(){return(Si=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function Ei(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Ti(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Ii(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=Ii(t[n],e[n]));return t}function Ci(t,e,n){t[e]=n}var Di="FirebaseError",Ai=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=Di,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,Ni.prototype.create),i}return wi(e,t),e}(Error),Ni=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t,e){void 0===e&&(e={});for(var n=this.service+"/"+t,r=this.errors[t],i=r?function(t,e){return t.replace(ki,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(r,e):"Error",o=this.serviceName+": "+i+" ("+n+").",a=new Ai(n,o),s=0,u=Object.keys(e);s<u.length;s++){var c=u[s];"_"!==c.slice(-1)&&(c in a&&console.warn('Overwriting FirebaseError base field "'+c+'" can cause unexpected behavior.'),a[c]=e[c])}return a},t}();var ki=/\{\$([^}]+)}/g;function Oi(t,e){var n=new Ri(t,e);return n.subscribe.bind(n)}var _i,Ri=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Mi),void 0===r.error&&(r.error=Mi),void 0===r.complete&&(r.complete=Mi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function Mi(){}var Pi=((_i={})["no-app"]="No Firebase App '{$name}' has been created - call Firebase App.initializeApp()",_i["bad-app-name"]="Illegal App name: '{$name}",_i["duplicate-app"]="Firebase App named '{$name}' already exists",_i["app-deleted"]="Firebase App named '{$name}' already deleted",_i["duplicate-service"]="Firebase service named '{$name}' already registered",_i["invalid-app-argument"]="firebase.{$name}() takes either no argument or a Firebase App instance.",_i),xi=new Ni("app","Firebase",Pi);function Li(t,e){throw xi.create(t,e)}var Fi="[DEFAULT]",qi=[],Bi=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Ii(void 0,t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){qi.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){qi=qi.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=Fi),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==Fi?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;Ii(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(qi.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),qi=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&Li("app-deleted",{name:this.name_})},t}();function Vi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}Bi.prototype.name&&Bi.prototype.options||Bi.prototype.delete||console.log("dc");var Ui=!1;try{Ui="[object process]"===Object.prototype.toString.call(global.process)}catch(t){}if(Ui&&console.warn('\nWarning: This is a browser-targeted Firebase bundle but it appears it is being\nrun in a Node environment.  If running in a Node environment, make sure you\nare using the bundle specified by the "main" field in package.json.\n\nIf you are using Webpack, you can specify "main" as the first item in\n"resolve.mainFields":\nhttps://webpack.js.org/configuration/resolve/#resolvemainfields\n\nIf using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\nto false and "main" to true:\nhttps://github.com/rollup/rollup-plugin-node-resolve\n'),self&&"firebase"in self){console.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var ji=self.firebase.SDK_VERSION;ji&&ji.indexOf("LITE")>=0&&console.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var Qi,Ki=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){if(void 0===r&&(r={}),"object"!=typeof r||null===r){var o=r;r={name:o}}var a=r;void 0===a.name&&(a.name=Fi);var u=a.name;"string"==typeof u&&u||Li("bad-app-name",{name:String(u)}),Vi(e,u)&&Li("duplicate-app",{name:u});var c=new t(n,a,i);return e[u]=c,s(c,"create"),c},app:o,apps:null,Promise:Promise,SDK_VERSION:"5.11.0",INTERNAL:{registerService:function(e,s,u,c,h){function l(t){return void 0===t&&(t=o()),"function"!=typeof t[e]&&Li("invalid-app-argument",{name:e}),t[e]()}return void 0===h&&(h=!1),n[e]&&Li("duplicate-service",{name:e}),n[e]=s,c&&(r[e]=c,a().forEach(function(t){c("create",t)})),void 0!==u&&Ii(l,u),i[e]=l,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,h?t:[])},l},removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u}};function o(t){return Vi(e,t=t||Fi)||Li("no-app",{name:t}),e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function s(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=u(t,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function u(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return Ci(i,"default",i),Object.defineProperty(i,"apps",{get:a}),Ci(o,"App",t),i}(Bi);return e.INTERNAL=Si({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){Ii(e,t)},createSubscribe:Oi,ErrorFactory:Ni,deepExtend:Ii}),e}();!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Qi||(Qi={}));var Gi,Wi=Qi.INFO,zi=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Qi.DEBUG:case Qi.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Qi.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Qi.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Qi.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},$i=function(){function t(t){this.name=t,this._logLevel=Wi,this._logHandler=zi}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Qi))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Qi.ERROR].concat(t))},t}(),Hi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Yi=Yi||{},Xi=Hi;function Ji(t){return"string"==typeof t}function Zi(t){return"number"==typeof t}function to(t,e){t=t.split("."),e=e||Xi;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function eo(){}function no(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function ro(t){return"array"==no(t)}function io(t){var e=no(t);return"array"==e||"object"==e&&"number"==typeof t.length}function oo(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ao="closure_uid_"+(1e9*Math.random()>>>0),so=0;function uo(t,e,n){return t.call.apply(t.bind,arguments)}function co(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function ho(t,e,n){return(ho=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?uo:co).apply(null,arguments)}function lo(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var fo=Date.now||function(){return+new Date};function po(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function mo(){this.j=this.j,this.i=this.i}mo.prototype.j=!1,mo.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[ao]||(this[ao]=++so)},mo.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var yo=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Ji(t))return Ji(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},go=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Ji(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function vo(t){return Array.prototype.concat.apply([],arguments)}function bo(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function wo(t){return/^[\s\xa0]*$/.test(t)}var So,Eo=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function To(t,e){return-1!=t.indexOf(e)}function Io(t,e){return t<e?-1:t>e?1:0}t:{var Co=Xi.navigator;if(Co){var Do=Co.userAgent;if(Do){So=Do;break t}}So=""}function Ao(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function No(t){var e,n={};for(e in t)n[e]=t[e];return n}var ko="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Oo(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ko.length;o++)n=ko[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function _o(t){return _o[" "](t),t}_o[" "]=eo;var Ro,Mo,Po=To(So,"Opera"),xo=To(So,"Trident")||To(So,"MSIE"),Lo=To(So,"Edge"),Fo=Lo||xo,qo=To(So,"Gecko")&&!(To(So.toLowerCase(),"webkit")&&!To(So,"Edge"))&&!(To(So,"Trident")||To(So,"MSIE"))&&!To(So,"Edge"),Bo=To(So.toLowerCase(),"webkit")&&!To(So,"Edge");function Vo(){var t=Xi.document;return t?t.documentMode:void 0}t:{var Uo="",jo=(Mo=So,qo?/rv:([^\);]+)(\)|;)/.exec(Mo):Lo?/Edge\/([\d\.]+)/.exec(Mo):xo?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Mo):Bo?/WebKit\/(\S+)/.exec(Mo):Po?/(?:Version)[ \/]?(\S+)/.exec(Mo):void 0);if(jo&&(Uo=jo?jo[1]:""),xo){var Qo=Vo();if(null!=Qo&&Qo>parseFloat(Uo)){Ro=String(Qo);break t}}Ro=Uo}var Ko,Go={};function Wo(t){return function(t,e){var n=Go;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=Eo(String(Ro)).split("."),r=Eo(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=Io(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Io(0==a[2].length,0==s[2].length)||Io(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}var zo=Xi.document;Ko=zo&&xo?Vo()||("CSS1Compat"==zo.compatMode?parseInt(Ro,10):5):void 0;var $o=!xo||9<=Number(Ko),Ho=xo&&!Wo("9"),Yo=function(){if(!Xi.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Xi.addEventListener("test",eo,e),Xi.removeEventListener("test",eo,e)}catch(t){}return t}();function Xo(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function Jo(t,e){if(Xo.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(qo){t:{try{_o(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Ji(t.pointerType)?t.pointerType:Zo[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Xo.prototype.b=function(){this.Ja=!1},po(Jo,Xo);var Zo={2:"touch",3:"pen",4:"mouse"};Jo.prototype.b=function(){Jo.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Ho)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var ta="closure_listenable_"+(1e6*Math.random()|0),ea=0;function na(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++ea,this.X=this.Z=!1}function ra(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function ia(t){this.src=t,this.a={},this.b=0}function oa(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=yo(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ra(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function aa(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}ia.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=aa(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new na(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var sa="closure_lm_"+(1e6*Math.random()|0),ua={};function ca(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(ro(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=ga(r);return e&&e[ta]?e.Ba(n,r,oo(i)?!!i.capture:!!i,o):ha(e,n,r,!0,i,o)}(t,e,n,r,i);if(ro(e)){for(var o=0;o<e.length;o++)ca(t,e[o],n,r,i);return null}return n=ga(n),t&&t[ta]?t.Aa(e,n,oo(r)?!!r.capture:!!r,i):ha(t,e,n,!1,r,i)}function ha(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=oo(i)?!!i.capture:!!i;if(a&&!$o)return null;var s=ma(t);if(s||(t[sa]=s=new ia(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=da,e=$o?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Yo||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(fa(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function la(t){if(!Zi(t)&&t&&!t.X){var e=t.src;if(e&&e[ta])oa(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(fa(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ma(e))?(oa(n,t),0==n.b&&(n.src=null,e[sa]=null)):ra(t)}}}function fa(t){return t in ua?ua[t]:ua[t]="on"+t}function pa(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&la(t),n.call(r,e)}function da(t,e){return!!t.X||($o?pa(t,new Jo(e,this)):pa(t,e=new Jo(e||to("window.event"),this)))}function ma(t){return(t=t[sa])instanceof ia?t:null}var ya="__closure_events_fn_"+(1e9*Math.random()>>>0);function ga(t){return"function"==no(t)?t:(t[ya]||(t[ya]=function(e){return t.handleEvent(e)}),t[ya])}function va(){mo.call(this),this.c=new ia(this),this.J=this,this.B=null}function ba(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&oa(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}po(va,mo),va.prototype[ta]=!0,(Gi=va.prototype).addEventListener=function(t,e,n,r){ca(this,t,e,n,r)},Gi.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(ro(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=oo(i)?!!i.capture:!!i,r=ga(r),e&&e[ta]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=aa(a=e.a[n],r,i,o))&&(ra(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=ma(e))&&(n=e.a[n.toString()],e=-1,n&&(e=aa(n,r,i,o)),(r=-1<e?n[e]:null)&&la(r))}(this,t,e,n,r)},Gi.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(Ji(t))t=new Xo(t,n);else if(t instanceof Xo)t.target=t.target||n;else{var i=t;Oo(t=new Xo(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=ba(a,r,!0,t)&&i}if(i=ba(a=t.a=n,r,!0,t)&&i,i=ba(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=ba(a=t.a=e[o],r,!1,t)&&i;return i},Gi.G=function(){if(va.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)ra(n[r]);delete e.a[t],e.b--}}this.B=null},Gi.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},Gi.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var wa=Xi.JSON.stringify;function Sa(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Ea(){this.b=this.a=null}Sa.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Ta,Ia=new Sa(function(){return new Da},function(t){t.reset()});function Ca(){var t=Oa,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Da(){this.next=this.b=this.a=null}function Aa(t){Xi.setTimeout(function(){throw t},0)}function Na(t,e){Ta||function(){var t=Xi.Promise.resolve(void 0);Ta=function(){t.then(_a)}}(),ka||(Ta(),ka=!0),Oa.add(t,e)}Ea.prototype.add=function(t,e){var n=Ia.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Da.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Da.prototype.reset=function(){this.next=this.b=this.a=null};var ka=!1,Oa=new Ea;function _a(){for(var t;t=Ca();){try{t.a.call(t.b)}catch(t){Aa(t)}var e=Ia;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}ka=!1}function Ra(t,e){va.call(this),this.b=t||1,this.a=e||Xi,this.f=ho(this.gb,this),this.g=fo()}function Ma(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Pa(t,e,n){if("function"==no(t))n&&(t=ho(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=ho(t.handleEvent,t)}return 2147483647<Number(e)?-1:Xi.setTimeout(t,e||0)}function xa(t,e,n){mo.call(this),this.f=null!=n?ho(t,n):t,this.c=e,this.b=ho(this.ab,this),this.a=[]}function La(t){t.U=Pa(t.b,t.c),t.f.apply(null,t.a)}function Fa(t){mo.call(this),this.b=t,this.a={}}po(Ra,va),(Gi=Ra.prototype).ba=!1,Gi.L=null,Gi.gb=function(){if(this.ba){var t=fo()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Ma(this),this.start()))}},Gi.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=fo())},Gi.G=function(){Ra.N.G.call(this),Ma(this),delete this.a},po(xa,mo),(Gi=xa.prototype).ea=!1,Gi.U=null,Gi.Ua=function(t){this.a=arguments,this.U?this.ea=!0:La(this)},Gi.G=function(){xa.N.G.call(this),this.U&&(Xi.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},Gi.ab=function(){this.U=null,this.ea&&(this.ea=!1,La(this))},po(Fa,mo);var qa=[];function Ba(t,e,n,r){ro(n)||(n&&(qa[0]=n.toString()),n=qa);for(var i=0;i<n.length;i++){var o=ca(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Va(t){Ao(t.a,function(t,e){this.a.hasOwnProperty(e)&&la(t)},t),t.a={}}function Ua(){}Fa.prototype.G=function(){Fa.N.G.call(this),Va(this)},Fa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ja=new va;function Qa(t){Xo.call(this,"serverreachability",t)}function Ka(t){ja.dispatchEvent(new Qa(ja,t))}function Ga(t){Xo.call(this,"statevent",t)}function Wa(t){ja.dispatchEvent(new Ga(ja,t))}function za(t){Xo.call(this,"timingevent",t)}function $a(t,e){if("function"!=no(t))throw Error("Fn must not be null and must be a function");return Xi.setTimeout(function(){t()},e)}po(Qa,Xo),po(Ga,Xo),po(za,Xo);var Ha={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},Ya={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Xa(){}function Ja(t){var e;return(e=t.a)||(e=t.a={}),e}function Za(){}Xa.prototype.a=null;var ts,es={OPEN:"a",ib:"b",Na:"c",rb:"d"};function ns(){Xo.call(this,"d")}function rs(){Xo.call(this,"c")}function is(){}function os(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Fa(this),this.O=as,t=Fo?125:void 0,this.P=new Ra(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}po(ns,Xo),po(rs,Xo),po(is,Xa),ts=new is;var as=45e3,ss={},us={};function cs(t,e,n){t.F=1,t.f=Ps(As(e)),t.l=n,t.H=!0,ls(t,null)}function hs(t,e,n,r){t.F=1,t.f=Ps(As(e)),t.l=null,t.H=n,ls(t,r)}function ls(t,e){t.v=fo(),ds(t),t.D=As(t.f),Ms(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new xa(ho(t.Ka,t,t.a),t.J)),Ba(t.I,t.a,"readystatechange",t.eb),e=t.h?No(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),Ka(1)}function fs(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=ps(t,n);if(i==us){4==e&&(t.c=4,Wa(14),r=!1);break}if(i==ss){t.c=4,Wa(15),r=!1;break}bs(t,i)}4==e&&0==n.length&&(t.c=1,Wa(16),r=!1),t.b=t.b&&r,r||(vs(t),gs(t))}function ps(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?us:(n=Number(e.substring(n,r)),isNaN(n)?ss:(r+=1)+n>e.length?us:(e=e.substr(r,n),t.A=r+n,e))}function ds(t){t.R=fo()+t.O,ms(t,t.O)}function ms(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=$a(ho(t.bb,t),e)}function ys(t){t.i&&(Xi.clearTimeout(t.i),t.i=null)}function gs(t){t.g.Da()||t.m||t.g.na(t)}function vs(t){ys(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Ma(t.P),Va(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function bs(t,e){try{t.g.Ga(t,e),Ka(4)}catch(t){}}function ws(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(io(t)||Ji(t))go(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(io(t)||Ji(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(Ji(t))return t.split("");if(io(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ss(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ss)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Es(t,e){Is(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ts(t))}function Ts(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Is(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Is(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Is(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Gi=os.prototype).setTimeout=function(t){this.O=t},Gi.eb=function(t){t=t.target;var e=this.B;e&&3==Du(t)?e.Ua():this.Ka(t)},Gi.Ka=function(t){try{if(t==this.a)t:{var e=Du(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!Fo&&!this.a.aa())){this.m||4!=e||7==n||Ka(8==n||0>=r?3:2),ys(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Au(this.a,"X-HTTP-Initial-Response");if(a&&!wo(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,Wa(12),vs(this),gs(this);break t}this.s=!0,bs(this,s)}this.H?(fs(this,e,o),Fo&&this.b&&3==e&&(Ba(this.I,this.P,"tick",this.cb),this.P.start())):bs(this,o),4==e&&vs(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,ds(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,Wa(12)):(this.c=0,Wa(13)),vs(this),gs(this)}}}catch(t){}},Gi.cb=function(){if(this.a){var t=Du(this.a),e=this.a.aa();this.A<e.length&&(ys(this),fs(this,t,e),this.b&&4!=t&&ds(this))}},Gi.cancel=function(){this.m=!0,vs(this)},Gi.bb=function(){this.i=null;var t=fo();0<=t-this.R?(2!=this.F&&(Ka(3),Wa(17)),vs(this),this.c=2,gs(this)):ms(this,this.R-t)},(Gi=Ss.prototype).C=function(){Ts(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},Gi.K=function(){return Ts(this),this.a.concat()},Gi.get=function(t,e){return Is(this.b,t)?this.b[t]:e},Gi.set=function(t,e){Is(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},Gi.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Cs=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ds(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Ds?(this.h=void 0!==e?e:t.h,Ns(this,t.f),this.j=t.j,ks(this,t.b),Os(this,t.i),this.a=t.a,_s(this,$s(t.c)),this.g=t.g):t&&(n=String(t).match(Cs))?(this.h=!!e,Ns(this,n[1]||"",!0),this.j=xs(n[2]||""),ks(this,n[3]||"",!0),Os(this,n[4]),this.a=xs(n[5]||"",!0),_s(this,n[6]||"",!0),this.g=xs(n[7]||"")):(this.h=!!e,this.c=new Qs(null,this.h))}function As(t){return new Ds(t)}function Ns(t,e,n){t.f=n?xs(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function ks(t,e,n){t.b=n?xs(e,!0):e}function Os(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function _s(t,e,n){e instanceof Qs?(t.c=e,function(t,e){e&&!t.f&&(Ks(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Gs(this,e),zs(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Ls(e,Us)),t.c=new Qs(e,t.h))}function Rs(t,e,n){t.c.set(e,n)}function Ms(t,e,n){ro(n)||(n=[String(n)]),zs(t.c,e,n)}function Ps(t){return Rs(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^fo()).toString(36)),t}function xs(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ls(t,e,n){return Ji(t)?(t=encodeURI(t).replace(e,Fs),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Fs(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ds.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ls(e,qs,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ls(e,qs,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ls(n,"/"==n.charAt(0)?Vs:Bs,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Ls(n,js)),t.join("")},Ds.prototype.resolve=function(t){var e=As(this),n=!!t.f;n?Ns(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?ks(e,t.b):n=null!=t.i;var r=t.a;if(n)Os(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(To(i,"./")||To(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?_s(e,$s(t.c)):n=!!t.g,n&&(e.g=t.g),e};var qs=/[#\/\?@]/g,Bs=/[#\?:]/g,Vs=/[#\?]/g,Us=/[#\?@]/g,js=/#/g;function Qs(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Ks(t){t.a||(t.a=new Ss,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Gs(t,e){Ks(t),e=Hs(t,e),Is(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Es(t.a,e))}function Ws(t,e){return Ks(t),e=Hs(t,e),Is(t.a.b,e)}function zs(t,e,n){Gs(t,e),0<n.length&&(t.c=null,t.a.set(Hs(t,e),bo(n)),t.b+=n.length)}function $s(t){var e=new Qs;return e.c=t.c,t.a&&(e.a=new Ss(t.a),e.b=t.b),e}function Hs(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Ys(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Xs(t){var e=t.a.F.a;if(null!=e)Wa(4),e?(Wa(10),Bu(t.a,t,!1)):(Wa(11),Bu(t.a,t,!0));else{t.b=new os(t,void 0,void 0),t.b.h=t.h,e=Ku(e=t.a,e.Y()?t.f:null,t.i),Wa(4),Ms(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Rs(e,n,r),hs(t.b,e,!1,t.f)}}function Js(){this.a=this.b=null}function Zs(){this.a=new Ss}function tu(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[ao]||(t[ao]=++so)):e.charAt(0)+t}function eu(t,e){this.b=t,this.a=e}function nu(t){this.g=t||ru,Xi.PerformanceNavigationTiming?t=0<(t=Xi.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(Xi.ka&&Xi.ka.Ea&&Xi.ka.Ea()&&Xi.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Zs),this.b=null,this.c=[]}(Gi=Qs.prototype).add=function(t,e){Ks(this),this.c=null,t=Hs(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},Gi.forEach=function(t,e){Ks(this),this.a.forEach(function(n,r){go(n,function(n){t.call(e,n,r,this)},this)},this)},Gi.K=function(){Ks(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Gi.C=function(t){Ks(this);var e=[];if(Ji(t))Ws(this,t)&&(e=vo(e,this.a.get(Hs(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=vo(e,t[n])}return e},Gi.set=function(t,e){return Ks(this),this.c=null,Ws(this,t=Hs(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},Gi.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},Gi.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},po(function(){},function(){}),(Gi=Ys.prototype).M=null,Gi.$=function(t){return this.a.$(t)},Gi.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},Gi.Da=function(){return!1},Gi.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Au(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Au(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void ju(e,2)}this.f=r[0]}else(e=this.a).m=this.c,ju(e,2)}else 1==this.M&&(this.g?Wa(6):"11111"==e?(Wa(5),this.g=!0,(!xo||10<=Number(Ko))&&(this.c=200,this.b.cancel(),Wa(11),Bu(this.a,this,!0))):(Wa(7),this.g=!1))},Gi.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Xs(this)):1==this.M&&(this.g?(Wa(11),Bu(this.a,this,!0)):(Wa(10),Bu(this.a,this,!1)));else{0==this.M?Wa(8):1==this.M&&Wa(9);var t=this.a;t.m=this.c,ju(t,2)}},Gi.Y=function(){return this.a.Y()},Gi.ma=function(){return this.a.ma()},Zs.prototype.add=function(t){this.a.set(tu(t),t)},Zs.prototype.C=function(){return this.a.C()};var ru=10;function iu(t,e){!t.a&&(To(e,"spdy")||To(e,"quic")||To(e,"h2"))&&(t.f=t.g,t.a=new Zs,t.b&&(uu(t,t.b),t.b=null))}function ou(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function au(t){return t.b?1:t.a?t.a.a.c:0}function su(t,e){return t.b?t=t.b==e:t.a?(e=tu(e),t=Is(t.a.a.b,e)):t=!1,t}function uu(t,e){t.a?t.a.add(e):t.b=e}function cu(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=tu(e),n=Is(t.a.a.b,n)),n&&Es(t.a.a,tu(e)))}function hu(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return go(t.a.C(),function(t){e=e.concat(t.j)}),e}return bo(t.c)}function lu(){}function fu(){this.a=new lu}function pu(t,e,n){var r=n||"";try{ws(t,function(t,n){var i=t;oo(t)&&(i=wa(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function du(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}nu.prototype.cancel=function(){var t;this.c=hu(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(go(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},lu.prototype.stringify=function(t){return Xi.JSON.stringify(t,void 0)},lu.prototype.parse=function(t){return Xi.JSON.parse(t,void 0)};var mu=Xi.JSON.parse;function yu(t){va.call(this),this.headers=new Ss,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=gu,this.D=this.F=!1}po(yu,va);var gu="",vu=/^https?$/i,bu=["POST","PUT"];function wu(t){return"content-type"==t.toLowerCase()}function Su(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Eu(t),Iu(t)}function Eu(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Tu(t){if(t.b&&void 0!==Yi&&(!t.s[1]||4!=Du(t)||2!=t.T()))if(t.l&&4==Du(t))Pa(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Du(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Cs)[1]||null;if(!o&&Xi.self&&Xi.self.location){var a=Xi.self.location.protocol;o=a.substr(0,a.length-1)}i=!vu.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Eu(t))}finally{Iu(t)}}}function Iu(t,e){if(t.a){Cu(t);var n=t.a,r=t.s[0]?eo:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Cu(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(Xi.clearTimeout(t.m),t.m=null)}function Du(t){return t.a?t.a.readyState:0}function Au(t,e){return t.a?t.a.getResponseHeader(e):null}function Nu(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return Ao(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),Ji(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Rs(t,e,n),t}function ku(t){this.f=[],this.F=new Js,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!to("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=to("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=to("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=to("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=to("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new nu(t&&t.concurrentRequestLimit),this.ja=new fu,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Ou(t){if(_u(t),3==t.u){var e=t.P++,n=As(t.B);Rs(n,"SID",t.H),Rs(n,"RID",e),Rs(n,"TYPE","terminate"),xu(t,n),(e=new os(t,e,void 0)).F=2,e.f=Ps(As(n)),n=!1,Xi.navigator&&Xi.navigator.sendBeacon&&(n=Xi.navigator.sendBeacon(e.f.toString(),"")),!n&&Xi.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=fo(),ds(e)}Qu(t)}function _u(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(Xi.clearTimeout(t.l),t.l=null),Vu(t),t.b.cancel(),t.h&&(Zi(t.h)&&Xi.clearTimeout(t.h),t.h=null)}function Ru(t,e){t.f.push(new eu(t.Ra++,e)),3==t.u&&Mu(t)}function Mu(t){ou(t.b)||t.h||(t.h=!0,Na(t.Ia,t),t.A=0)}function Pu(t,e){var n;n=e?e.W:t.P++;var r=As(t.B);Rs(r,"SID",t.H),Rs(r,"RID",n),Rs(r,"AID",t.O),xu(t,r),t.g&&t.i&&Nu(r,t.g,t.i),n=new os(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Lu(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),uu(t.b,n),cs(n,r,e)}function xu(t,e){t.c&&ws({},function(t,n){Rs(e,n,t)})}function Lu(t,e,n){n=Math.min(t.f.length,n);var r=t.c?ho(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{pu(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Fu(t){t.a||t.l||(t.S=1,Na(t.Ha,t),t.v=0)}function qu(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=$a(ho(t.Ha,t),Uu(t,t.v)),t.v++,!0)}function Bu(t,e,n){var r=e.l;r&&iu(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Ku(t,null,t.ha),Mu(t)}function Vu(t){null!=t.s&&(Xi.clearTimeout(t.s),t.s=null)}function Uu(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function ju(t,e){if(2==e){var n=null;t.c&&(n=null);var r=ho(t.fb,t);n||(n=new Ds("//www.google.com/images/cleardot.gif"),Xi.location&&"http"==Xi.location.protocol||Ns(n,"https"),Ps(n)),function(t,e){var n=new Ua;if(Xi.Image){var r=new Image;r.onload=lo(du,n,r,"TestLoadImage: loaded",!0,e),r.onerror=lo(du,n,r,"TestLoadImage: error",!1,e),r.onabort=lo(du,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=lo(du,n,r,"TestLoadImage: timeout",!1,e),Xi.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Wa(2);t.u=0,t.c&&t.c.ta(e),Qu(t),_u(t)}function Qu(t){t.u=0,t.m=-1,t.c&&(0==hu(t.b).length&&0==t.f.length||(t.b.c.length=0,bo(t.f),t.f.length=0),t.c.sa())}function Ku(t,e,n){var r=function(t){return t instanceof Ds?As(t):new Ds(t,void 0)}(n);if(""!=r.b)e&&ks(r,e+"."+r.b),Os(r,r.i);else{var i,o=Xi.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Ds(null,void 0);return t&&Ns(i,t),e&&ks(i,e),n&&Os(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Ao(t.V,function(t,e){Rs(r,e,t)}),e=t.j,n=t.I,e&&n&&Rs(r,e,n),Rs(r,"VER",t.wa),xu(t,r),r}function Gu(){}function Wu(){if(xo&&!(10<=Number(Ko)))throw Error("Environmental error: no available transport.")}function zu(t,e){va.call(this),this.a=new ku(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!wo(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!wo(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Yu(this)}function $u(t){ns.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Hu(){rs.call(this),this.status=1}function Yu(t){this.a=t}(Gi=yu.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ja(this.H):Ja(ts),this.a.onreadystatechange=ho(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Su(this,t)}t=n||"";var i=new Ss(this.headers);r&&ws(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=wu,n=t.length,r=Ji(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:Ji(t)?t.charAt(e):t[e]}(i.K()),n=Xi.FormData&&t instanceof Xi.FormData,!(0<=yo(bu,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cu(this),0<this.o&&((this.D=function(t){return xo&&Wo(9)&&Zi(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=ho(this.Ca,this)):this.m=Pa(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Su(this,t)}},Gi.Ca=function(){void 0!==Yi&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},Gi.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Iu(this))},Gi.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Iu(this,!0)),yu.N.G.call(this)},Gi.Fa=function(){this.j||(this.w||this.l||this.g?Tu(this):this.$a())},Gi.$a=function(){Tu(this)},Gi.T=function(){try{return 2<Du(this)?this.a.status:-1}catch(t){return-1}},Gi.za=function(){try{return 2<Du(this)?this.a.statusText:""}catch(t){return""}},Gi.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},Gi.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),mu(e)}},Gi.ya=function(){return this.h},Gi.Ya=function(){return Ji(this.f)?this.f:String(this.f)},(Gi=ku.prototype).wa=8,Gi.u=1,Gi.Da=function(){return 0==this.u},Gi.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new os(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?Oo(r=No(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&Ji(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Lu(this,n,e),Rs(i=As(this.B),"RID",t),Rs(i,"CVER",22),this.o&&this.j&&Rs(i,"X-HTTP-Session-Id",this.j),xu(this,i),this.g&&r&&Nu(i,this.g,r),uu(this.b,n),this.W?(Rs(i,"$req",e),Rs(i,"SID","null"),n.S=!0,cs(n,i,null)):cs(n,i,e),this.u=2}}else 3==this.u&&(t?Pu(this,t):0==this.f.length||ou(this.b)||Pu(this))},Gi.Ha=function(){this.l=null,this.a=new os(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=As(this.pa);Rs(t,"RID","rpc"),Rs(t,"SID",this.H),Rs(t,"CI",this.ia?"0":"1"),Rs(t,"AID",this.O),xu(this,t),Rs(t,"TYPE","xmlhttp"),this.g&&this.i&&Nu(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),hs(this.a,t,!0,this.ga)},Gi.Ga=function(t,e){if(0!=this.u&&(this.a==t||su(this.b,t)))if(this.m=t.o,!t.s&&su(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(ro(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Vu(this),this.a.cancel(),this.a=null}qu(this),Wa(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=$a(ho(this.Za,this),6e3));if(1>=au(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else ju(this,11)}else if((t.s||this.a==t)&&Vu(this),!wo(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&Zi(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Au(r,"X-Client-Wire-Protocol"))&&iu(this.b,i),this.j&&(r=Au(r,"X-HTTP-Session-Id")))&&(this.I=r,Rs(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Ku(this,this.Y()?this.ga:null,this.ha),r.s?(cu(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(ys(r),ds(r)),this.a=r):Fu(this),0<this.f.length&&Mu(this)}else"stop"!=r[0]&&"close"!=r[0]||ju(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?ju(this,7):Ou(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},Gi.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,qu(this),Wa(19))},Gi.na=function(t){var e=null;if(this.a==t){Vu(this),this.a=null;var n=2}else{if(!su(this.b,t))return;e=t.j,cu(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=fo()-t.v,ja.dispatchEvent(new za(ja,t.l?t.l.length:0,e,this.A)),Mu(this)):Fu(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(au(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=$a(ho(t.Ia,t,e),Uu(t,t.A)),t.A++,0)))}(this,t)||2==n&&qu(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:ju(this,5);break;case 4:ju(this,10);break;case 3:ju(this,6);break;default:ju(this,2)}}},Gi.fb=function(t){Wa(t?2:1)},Gi.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new yu(this.La)).F=this.R,t},Gi.ma=function(){return!!this.c&&!0},Gi.Y=function(){return this.R},(Gi=Gu.prototype).va=function(){},Gi.ua=function(){},Gi.ta=function(){},Gi.sa=function(){},Gi.Ta=function(){},Wu.prototype.a=function(t,e){return new zu(t,e)},po(zu,va),(Gi=zu.prototype).addEventListener=function(t,e,n,r){zu.N.addEventListener.call(this,t,e,n,r)},Gi.removeEventListener=function(t,e,n,r){zu.N.removeEventListener.call(this,t,e,n,r)},Gi.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;Wa(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Ys(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Nu(e,t.g,t.i)),(t=t.w).i=n,e=Ku(t.a,null,t.i),Wa(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Xs(t)):(Ms(e,"MODE","init"),!t.a.o&&t.a.j&&Ms(e,"X-HTTP-Session-Id",t.a.j),t.b=new os(t,void 0,void 0),t.b.h=t.h,hs(t.b,e,!1,null),t.M=0)},Gi.close=function(){Ou(this.a)},Gi.Xa=function(t){if(Ji(t)){var e={};e.__data__=t,Ru(this.a,e)}else this.h?((e={}).__data__=wa(t),Ru(this.a,e)):Ru(this.a,t)},Gi.G=function(){this.a.c=null,delete this.f,Ou(this.a),delete this.a,zu.N.G.call(this)},po($u,ns),po(Hu,rs),po(Yu,Gu),Yu.prototype.va=function(){this.a.dispatchEvent("a")},Yu.prototype.ua=function(t){this.a.dispatchEvent(new $u(t))},Yu.prototype.ta=function(t){this.a.dispatchEvent(new Hu(t))},Yu.prototype.sa=function(){this.a.dispatchEvent("b")};var Xu=lo(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},Wu);Wu.prototype.createWebChannel=Wu.prototype.a,zu.prototype.send=zu.prototype.Xa,zu.prototype.open=zu.prototype.Wa,zu.prototype.close=zu.prototype.close,Ha.NO_ERROR=0,Ha.TIMEOUT=8,Ha.HTTP_ERROR=6,Ya.COMPLETE="complete",Za.EventType=es,es.OPEN="a",es.CLOSE="b",es.ERROR="c",es.MESSAGE="d",va.prototype.listen=va.prototype.Aa,yu.prototype.listenOnce=yu.prototype.Ba,yu.prototype.getLastError=yu.prototype.Ya,yu.prototype.getLastErrorCode=yu.prototype.ya,yu.prototype.getStatus=yu.prototype.T,yu.prototype.getStatusText=yu.prototype.za,yu.prototype.getResponseJson=yu.prototype.Va,yu.prototype.getResponseText=yu.prototype.aa,yu.prototype.send=yu.prototype.ca;var Ju,Zu={createWebChannelTransport:Xu,ErrorCode:Ha,EventType:Ya,WebChannel:Za,XhrIo:yu},tc=Zu.createWebChannelTransport,ec=Zu.ErrorCode,nc=Zu.EventType,rc=Zu.WebChannel,ic=Zu.XhrIo,oc=Ki.SDK_VERSION,ac=new $i("@firebase/firestore");function sc(){return ac.logLevel===Qi.DEBUG?Ju.DEBUG:ac.logLevel===Qi.SILENT?Ju.SILENT:Ju.ERROR}function uc(t){switch(t){case Ju.DEBUG:ac.logLevel=Qi.DEBUG;break;case Ju.ERROR:ac.logLevel=Qi.ERROR;break;case Ju.SILENT:ac.logLevel=Qi.SILENT;break;default:ac.error("Firestore ("+oc+"): Invalid value passed to `setLogLevel`")}}function cc(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(ac.logLevel<=Qi.DEBUG){var i=n.map(lc);ac.debug.apply(ac,["Firestore ("+oc+") ["+t+"]: "+e].concat(i))}}function hc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ac.logLevel<=Qi.ERROR){var r=e.map(lc);ac.error.apply(ac,["Firestore ("+oc+"): "+t].concat(r))}}function lc(t){if("string"==typeof t)return t;var e=dc.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function fc(t){var e="FIRESTORE ("+oc+") INTERNAL ASSERTION FAILED: "+t;throw hc(e),new Error(e)}function pc(t,e){t||fc(e)}!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(Ju||(Ju={}));var dc=function(){function t(){}return t.setPlatform=function(e){t.platform&&fc("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||fc("Platform not set"),t.platform},t}();function mc(){return dc.getPlatform().emptyByteString}var yc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},gc=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return wi(e,t),e}(Error);function vc(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new gc(yc.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function bc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function wc(t,e){return void 0!==t?t:e}function Sc(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Ec(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Tc(t){for(var e in pc(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ic(t,e){if(0!==e.length)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Uc(e.length,"argument")+".")}function Cc(t,e,n){if(e.length!==n)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires "+Uc(n,"argument")+", but was called with "+Uc(e.length,"argument")+".")}function Dc(t,e,n){if(e.length<n)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Uc(n,"argument")+", but was called with "+Uc(e.length,"argument")+".")}function Ac(t,e,n,r){if(e.length<n||e.length>r)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Uc(e.length,"argument")+".")}function Nc(t,e,n,r){Pc(t,e,Vc(n)+" argument",r)}function kc(t,e,n,r){void 0!==r&&Nc(t,e,n,r)}function Oc(t,e,n,r){Pc(t,e,n+" option",r)}function _c(t,e,n,r){void 0!==r&&Oc(t,e,n,r)}function Rc(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Lc(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Lc(r[o]))}(t,e,n,r,i)}function Mc(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Lc(u))}var c=Lc(r);throw new gc(yc.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Pc(t,e,n,r){if(!("object"===e?xc(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Lc(r);throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function xc(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Lc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":fc("Unknown wrong type: "+typeof t)}function Fc(t,e,n){if(void 0===n)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Vc(e)+" argument, but it was undefined.")}function qc(t,e,n){Ec(e,function(e,r){if(n.indexOf(e)<0)throw new gc(yc.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function Bc(t,e,n,r){var i=Lc(r);return new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires its "+Vc(n)+" argument to be a "+e+", but it was: "+i)}function Vc(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Uc(t,e){return t+" "+e+(1===t?"":"s")}var jc=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return pc(20===e.length,"Invalid auto ID: "+e),e},t}();function Qc(t,e){return t<e?-1:t>e?1:0}function Kc(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Gc(t){return t+"\0"}function Wc(){if("undefined"==typeof Uint8Array)throw new gc(yc.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function zc(){if(!dc.getPlatform().base64Available)throw new gc(yc.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var $c,Hc,Yc=function(){function t(t){zc(),this._binaryString=t}return t.fromBase64String=function(e){Cc("Blob.fromBase64String",arguments,1),Nc("Blob.fromBase64String","string",1,e),zc();try{return new t(dc.getPlatform().atob(e))}catch(t){throw new gc(yc.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(Cc("Blob.fromUint8Array",arguments,1),Wc(),!(e instanceof Uint8Array))throw Bc("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return Cc("Blob.toBase64",arguments,0),zc(),dc.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){Cc("Blob.toUint8Array",arguments,0),Wc();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return Qc(this._binaryString,t._binaryString)},t}(),Xc=vc(Yc,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Jc=function(){function t(t,e){if(Cc("GeoPoint",arguments,2),Nc("GeoPoint","number",1,t),Nc("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new gc(yc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new gc(yc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return Qc(this._lat,t._lat)||Qc(this._long,t._long)},t}(),Zc=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new gc(yc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new gc(yc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new gc(yc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new gc(yc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Qc(this.nanoseconds,t.nanoseconds):Qc(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),th=function(){return function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}(),eh="(default)",nh=function(){function t(t,e){this.projectId=t,this.database=e||eh}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===eh},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return Qc(this.projectId,t.projectId)||Qc(this.database,t.database)},t}(),rh=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&fc("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&fc("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},t.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):"string"==typeof e?n.push(e):fc("Unknown parameter type for Path.child(): "+e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,pc(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return pc(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return pc(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return pc(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ih=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return wi(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new gc(yc.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(rh),oh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ah=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return wi(e,t),e.isValidIdentifier=function(t){return oh.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new gc(yc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new gc(yc.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new gc(yc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new gc(yc.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(rh),sh=function(){function t(e){this.path=e,pc(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ih.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ih.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ih(e.slice()))},t.fromPathString=function(e){return new t(ih.fromString(e))},t.EMPTY=new t(new ih([])),t}(),uh=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return sh.comparator(t.key,e.key)},t}(),ch=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n)||this;return a.data=r,a.proto=o,a.hasLocalMutations=!!i.hasLocalMutations,a.hasCommittedMutations=!!i.hasCommittedMutations,a}return wi(e,t),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return void 0!==r&&void 0!==i?r.compareTo(i):fc("Trying to compare documents on fields that don't exist")},e}(uh),hh=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return wi(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(uh),lh=function(t){function e(e,n){return t.call(this,e,n)||this}return wi(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(uh),fh=function(){function t(t,e){this.comparator=t,this.root=e||dh.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,dh.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dh.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ph(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ph(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ph(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ph(this.root,t,this.comparator,!0)},t}(),ph=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){pc(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),dh=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw fc("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw fc("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw fc("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),mh=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new dh(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();dh.EMPTY=new mh,function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}($c||($c={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(Hc||(Hc={}));var yh=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(Hc.Estimate,n);case"previous":return new t(Hc.Previous,n);case"none":case void 0:return new t(Hc.Default,n);default:return fc("fromSnapshotOptions() called with invalid options.")}},t}(),gh=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return pc(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Qc(this.typeOrder,t.typeOrder)},t}(),vh=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=$c.NullValue,e.internalValue=null,e}return wi(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(gh),bh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.BooleanValue,n}return wi(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Qc(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(gh),wh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.NumberValue,n}return wi(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue,r=t.internalValue,n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var n,r},e}(gh);function Sh(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Eh=function(t){function e(e){return t.call(this,e)||this}return wi(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Sh(this.internalValue,t.internalValue)},e}(wh),Th=function(t){function e(e){var n=t.call(this,e)||this;return n.internalValue=e,n}return wi(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Sh(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(wh),Ih=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.StringValue,n}return wi(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Qc(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(gh),Ch=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.TimestampValue,n}return wi(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Dh?-1:this.defaultCompareTo(t)},e}(gh),Dh=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=$c.TimestampValue,r}return wi(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===Hc.Estimate?new Ch(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Hc.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Ch?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(gh),Ah=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.BlobValue,n}return wi(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(gh),Nh=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=$c.RefValue,r}return wi(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:sh.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(gh),kh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.GeoPointValue,n}return wi(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(gh),Oh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.ObjectValue,n}return wi(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=Qc(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return Qc(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(pc(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(pc(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return void 0!==this.field(t)},e.prototype.field=function(t){pc(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e&&n.internalValue.get(t)||void 0}),n},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new fh(Qc)),e}(gh),_h=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=$c.ArrayValue,n}return wi(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return Qc(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},e}(gh),Rh=Number,Mh=Rh.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Ph=Rh.MAX_SAFE_INTEGER||Math.pow(2,53)-1,xh=Rh.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Lh(t){return null==t}function Fh(t){return xh(t)&&t<=Ph&&t>=Mh}var qh,Bh=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[$h]:this.memoizedOrderBy=[new zh(t),$h];else{pc(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Gh.ASCENDING;this.memoizedOrderBy.push(a===Gh.ASCENDING?$h:Hh)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){pc(null==this.getInequalityFilterField()||!(e instanceof jh)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),pc(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){pc(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}Lh(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),Lh(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return pc(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!Lh(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof jh&&n.isInequality())return n.field}return null},t.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(t){return t instanceof jh&&t.op===Uh.ARRAY_CONTAINS})},t.prototype.isDocumentQuery=function(){return sh.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):sh.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&void 0===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){pc(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Vh=function(){function t(){}return t.create=function(t,e,n){if(n.isEqual(vh.INSTANCE)){if(e!==Uh.EQUAL)throw new gc(yc.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new Qh(t)}if(n.isEqual(Th.NAN)){if(e!==Uh.EQUAL)throw new gc(yc.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new Kh(t)}return new jh(t,e,n)},t}(),Uh=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;default:return fc("Unknown relation: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t}(),jh=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return wi(e,t),e.prototype.matches=function(t){if(this.field.isKeyField()){pc(this.value instanceof Nh,"Comparing on key, but filter value not a RefValue"),pc(this.op!==Uh.ARRAY_CONTAINS,"array-contains queries don't make sense on document keys.");var e=this.value,n=sh.comparator(t.key,e.key);return this.matchesComparison(n)}var r=t.field(this.field);return void 0!==r&&this.matchesValue(r)},e.prototype.matchesValue=function(t){var e=this;return this.op===Uh.ARRAY_CONTAINS?t instanceof _h&&void 0!==t.internalValue.find(function(t){return t.isEqual(e.value)}):this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case Uh.LESS_THAN:return t<0;case Uh.LESS_THAN_OR_EQUAL:return t<=0;case Uh.EQUAL:return 0===t;case Uh.GREATER_THAN:return t>0;case Uh.GREATER_THAN_OR_EQUAL:return t>=0;default:return fc("Unknown relation op"+this.op)}},e.prototype.isInequality=function(){return this.op!==Uh.EQUAL&&this.op!==Uh.ARRAY_CONTAINS},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(Vh),Qh=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return wi(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return void 0!==e&&null===e.value()},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},e.prototype.toString=function(){return this.field.canonicalString()+" IS null"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(Vh),Kh=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return wi(e,t),e.prototype.matches=function(t){var e=t.field(this.field),n=e&&e.value();return"number"==typeof n&&isNaN(n)},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(Vh),Gh=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Wh=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){pc(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())pc(o instanceof Nh,"Bound has a non-key value where the key path is being used."),n=sh.comparator(o.key,e.key);else{var a=e.field(i.field);pc(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===Gh.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];return n.isEqual(r)}return!0},t}(),zh=function(){function t(t,e){this.field=t,void 0===e&&(e=Gh.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?ch.compareByKey(t,e):ch.compareByField(this.field,t,e);switch(this.dir){case Gh.ASCENDING:return n;case Gh.DESCENDING:return-1*n;default:return fc("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),$h=new zh(ah.keyField(),Gh.ASCENDING),Hh=new zh(ah.keyField(),Gh.DESCENDING),Yh=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new Zc(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new Zc(0,0)),t}();!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(qh||(qh={}));var Xh,Jh=function(){function t(t,e,n,r,i,o){void 0===i&&(i=Yh.MIN),void 0===o&&(o=mc()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),Zh=function(){function t(t){this.comparator=t,this.data=new fh(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new tl(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new tl(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),tl=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),el=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new Zh(ah.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.applyTo=function(t){var e=Oh.EMPTY;return this.fields.forEach(function(n){if(n.isEmpty())return t;var r=t.field(n);void 0!==r&&(e=e.set(n,r))}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),nl=function(){function t(t,e){this.field=t,this.transform=e}return Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return this.transform.isIdempotent},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),rl=function(){return function(t,e){this.version=t,this.transformResults=e}}();!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(Xh||(Xh={}));var il=function(){function t(t,e){this.updateTime=t,this.exists=e,pc(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof ch&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof ch:(pc(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),ol=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&pc(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof ch?t.version:Yh.MIN},t}(),al=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=Xh.Set,i}return wi(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),pc(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new ch(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=ol.getPostMutationVersion(t);return new ch(this.key,r,this.value,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(ol),sl=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=Xh.Patch,o}return wi(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),pc(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new lh(this.key,e.version);var n=this.patchDocument(t);return new ch(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=ol.getPostMutationVersion(t),i=this.patchDocument(t);return new ch(this.key,r,i,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof ch?t.data:Oh.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=void 0!==r?t.set(n,r):t.delete(n)}}),t},e}(ol),ul=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=Xh.Transform,r.precondition=il.exists(!0),r}return wi(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),pc(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new lh(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new ch(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,e),o=this.transformObject(r.data,i);return new ch(this.key,r.version,o,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){for(var t=0,e=this.fieldTransforms;t<e.length;t++){if(!e[t].isIdempotent)return!1}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){var t=new Zh(ah.comparator);return this.fieldTransforms.forEach(function(e){return t=t.add(e.field)}),new el(t)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&Kc(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){pc(t instanceof ch,"Unknown MaybeDocument type "+t);var e=t;return pc(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];pc(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof ch&&(a=t.field(i.field)||null),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e){for(var n=[],r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r],a=o.transform,s=null;e instanceof ch&&(s=e.field(o.field)||null),n.push(a.applyToLocalView(s,t))}return n},e.prototype.transformObject=function(t,e){pc(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(ol),cl=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=Xh.Delete,r}return wi(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),pc(null==e.transformResults,"Transform results received by DeleteMutation."),new hh(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&pc(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new hh(this.key,Yh.forDeletedDoc())):t},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e}(ol),hl=function(){function t(){this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return new Dh(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),ll=function(){function t(t){this.elements=t,this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=dl(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new _h(e)},t.prototype.isEqual=function(e){return e instanceof t&&Kc(e.elements,this.elements)},t}(),fl=function(){function t(t){this.elements=t,this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=dl(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new _h(e)},t.prototype.isEqual=function(e){return e instanceof t&&Kc(e.elements,this.elements)},t}(),pl=function(){function t(t){this.operand=t,this.isIdempotent=!1}return t.prototype.applyToLocalView=function(t,e){if(t instanceof Eh&&this.operand instanceof Eh){var n=t.internalValue+this.operand.internalValue;return new Eh(n)}if(t instanceof wh){n=t.internalValue+this.operand.internalValue;return new Th(n)}return this.operand},t.prototype.applyToRemoteDocument=function(t,e){return pc(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function dl(t){return t instanceof _h?t.internalValue.slice():[]}var ml,yl=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function gl(t){switch(t){case yc.OK:return fc("Treated status OK as error");case yc.CANCELLED:case yc.UNKNOWN:case yc.DEADLINE_EXCEEDED:case yc.RESOURCE_EXHAUSTED:case yc.INTERNAL:case yc.UNAVAILABLE:case yc.UNAUTHENTICATED:return!1;case yc.INVALID_ARGUMENT:case yc.NOT_FOUND:case yc.ALREADY_EXISTS:case yc.PERMISSION_DENIED:case yc.FAILED_PRECONDITION:case yc.ABORTED:case yc.OUT_OF_RANGE:case yc.UNIMPLEMENTED:case yc.DATA_LOSS:return!0;default:return fc("Unknown status code: "+t)}}function vl(t){if(void 0===t)return hc("GRPC error has no .code"),yc.UNKNOWN;switch(t){case ml.OK:return yc.OK;case ml.CANCELLED:return yc.CANCELLED;case ml.UNKNOWN:return yc.UNKNOWN;case ml.DEADLINE_EXCEEDED:return yc.DEADLINE_EXCEEDED;case ml.RESOURCE_EXHAUSTED:return yc.RESOURCE_EXHAUSTED;case ml.INTERNAL:return yc.INTERNAL;case ml.UNAVAILABLE:return yc.UNAVAILABLE;case ml.UNAUTHENTICATED:return yc.UNAUTHENTICATED;case ml.INVALID_ARGUMENT:return yc.INVALID_ARGUMENT;case ml.NOT_FOUND:return yc.NOT_FOUND;case ml.ALREADY_EXISTS:return yc.ALREADY_EXISTS;case ml.PERMISSION_DENIED:return yc.PERMISSION_DENIED;case ml.FAILED_PRECONDITION:return yc.FAILED_PRECONDITION;case ml.ABORTED:return yc.ABORTED;case ml.OUT_OF_RANGE:return yc.OUT_OF_RANGE;case ml.UNIMPLEMENTED:return yc.UNIMPLEMENTED;case ml.DATA_LOSS:return yc.DATA_LOSS;default:return fc("Unknown status code: "+t)}}function bl(t){if(void 0===t)return ml.OK;switch(t){case yc.OK:return ml.OK;case yc.CANCELLED:return ml.CANCELLED;case yc.UNKNOWN:return ml.UNKNOWN;case yc.DEADLINE_EXCEEDED:return ml.DEADLINE_EXCEEDED;case yc.RESOURCE_EXHAUSTED:return ml.RESOURCE_EXHAUSTED;case yc.INTERNAL:return ml.INTERNAL;case yc.UNAVAILABLE:return ml.UNAVAILABLE;case yc.UNAUTHENTICATED:return ml.UNAUTHENTICATED;case yc.INVALID_ARGUMENT:return ml.INVALID_ARGUMENT;case yc.NOT_FOUND:return ml.NOT_FOUND;case yc.ALREADY_EXISTS:return ml.ALREADY_EXISTS;case yc.PERMISSION_DENIED:return ml.PERMISSION_DENIED;case yc.FAILED_PRECONDITION:return ml.FAILED_PRECONDITION;case yc.ABORTED:return ml.ABORTED;case yc.OUT_OF_RANGE:return ml.OUT_OF_RANGE;case yc.UNIMPLEMENTED:return ml.UNIMPLEMENTED;case yc.DATA_LOSS:return ml.DATA_LOSS;default:return fc("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(ml||(ml={}));var wl=new fh(sh.comparator);function Sl(){return wl}function El(){return Sl()}var Tl=new fh(sh.comparator);function Il(){return Tl}var Cl=new fh(sh.comparator);function Dl(){return Cl}var Al=new Zh(sh.comparator);function Nl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Al,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var kl=new Zh(Qc);function Ol(){return kl}var _l,Rl,Ml=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||sh.comparator(e.key,n.key)}:function(t,e){return sh.comparator(t.key,e.key)},this.keyedMap=Il(),this.sortedSet=new fh(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(_l||(_l={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(Rl||(Rl={}));var Pl,xl=function(){function t(){this.changeMap=new fh(sh.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==_l.Added&&n.type===_l.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===_l.Metadata&&n.type!==_l.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===_l.Modified&&n.type===_l.Modified?this.changeMap=this.changeMap.insert(e,{type:_l.Modified,doc:t.doc}):t.type===_l.Modified&&n.type===_l.Added?this.changeMap=this.changeMap.insert(e,{type:_l.Added,doc:t.doc}):t.type===_l.Removed&&n.type===_l.Added?this.changeMap=this.changeMap.remove(e):t.type===_l.Removed&&n.type===_l.Modified?this.changeMap=this.changeMap.insert(e,{type:_l.Removed,doc:n.doc}):t.type===_l.Added&&n.type===_l.Removed?this.changeMap=this.changeMap.insert(e,{type:_l.Modified,doc:t.doc}):fc("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Ll=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:_l.Added,doc:t})}),new t(e,n,Ml.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Fl=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=ql.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Yh.MIN,i,Ol(),Sl(),Nl())},t}(),ql=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(mc(),n,Nl(),Nl(),Nl())},t}(),Bl=function(){return function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r}}(),Vl=function(){return function(t,e){this.targetId=t,this.existenceFilter=e}}();!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(Pl||(Pl={}));var Ul=function(){return function(t,e,n,r){void 0===n&&(n=mc()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}(),jl=function(){function t(){this.pendingResponses=0,this.documentChanges=Gl(),this._resumeToken=mc(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=Nl(),e=Nl(),n=Nl();return this.documentChanges.forEach(function(r,i){switch(i){case _l.Added:t=t.add(r);break;case _l.Modified:e=e.add(r);break;case _l.Removed:n=n.add(r);break;default:fc("Encountered invalid change type: "+i)}}),new ql(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Gl()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),Ql=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Sl(),this.pendingDocumentTargetMapping=Kl(),this.pendingTargetResets=new Zh(Qc)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof ch?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof hh&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case Pl.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case Pl.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case Pl.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),pc(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case Pl.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case Pl.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:fc("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):Sc(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new sh(i.path);this.removeDocumentFromTarget(e,o,new hh(o,Yh.forDeletedDoc()))}else pc(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};Sc(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new sh(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new hh(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=Nl();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===qh.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Fl(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Sl(),this.pendingDocumentTargetMapping=Kl(),this.pendingTargetResets=new Zh(Qc),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?_l.Modified:_l.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,_l.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new jl),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Zh(Qc),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;pc(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new jl,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function Kl(){return new fh(sh.comparator)}function Gl(){return new fh(sh.comparator)}var Wl,zl,$l=((Wl={})[Gh.ASCENDING.name]="ASCENDING",Wl[Gh.DESCENDING.name]="DESCENDING",Wl),Hl=((zl={})[Uh.LESS_THAN.name]="LESS_THAN",zl[Uh.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",zl[Uh.GREATER_THAN.name]="GREATER_THAN",zl[Uh.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",zl[Uh.EQUAL.name]="EQUAL",zl[Uh.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",zl),Yl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xl(t,e){pc(!Lh(t),e+" is missing")}function Jl(t){return"number"==typeof t?t:"string"==typeof t?Number(t):fc("can't parse "+t)}var Zl=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?yc.UNKNOWN:vl(t.code);return new gc(e,t.message||"")},t.prototype.toInt32Value=function(t){return Lh(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return Lh(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);pc(!!t,"Cannot deserialize null or undefined timestamp.");var e=Jl(t.seconds||"0"),n=t.nanos||0;return new Zc(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=Yl.exec(t);if(pc(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Zc(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(pc(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Yc.fromBase64String(t)):(pc(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),Yc.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return pc(!!t,"Trying to deserialize version that isn't set"),Yh.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=ih.fromString(t);return pc(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return pc(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),pc(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new sh(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?ih.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new ih(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new ih(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return pc(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof vh)return{nullValue:"NULL_VALUE"};if(t instanceof bh)return{booleanValue:t.value()};if(t instanceof Eh)return{integerValue:""+t.value()};if(t instanceof Th){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Ih?{stringValue:t.value()}:t instanceof Oh?{mapValue:this.toMapValue(t)}:t instanceof _h?{arrayValue:this.toArrayValue(t)}:t instanceof Ch?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof kh?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ah?{bytesValue:this.toBytes(t.value())}:t instanceof Nh?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:fc("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this,n=t.value_type;if(tf(t,n,"nullValue"))return vh.INSTANCE;if(tf(t,n,"booleanValue"))return bh.of(t.booleanValue);if(tf(t,n,"integerValue"))return new Eh(Jl(t.integerValue));if(tf(t,n,"doubleValue")){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Th.NAN;if("Infinity"===t.doubleValue)return Th.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Th.NEGATIVE_INFINITY}return new Th(t.doubleValue)}if(tf(t,n,"stringValue"))return new Ih(t.stringValue);if(tf(t,n,"mapValue"))return this.fromFields(t.mapValue.fields||{});if(tf(t,n,"arrayValue")){Xl(t.arrayValue,"arrayValue");var r=t.arrayValue.values||[];return new _h(r.map(function(t){return e.fromValue(t)}))}if(tf(t,n,"timestampValue"))return Xl(t.timestampValue,"timestampValue"),new Ch(this.fromTimestamp(t.timestampValue));if(tf(t,n,"geoPointValue")){Xl(t.geoPointValue,"geoPointValue");var i=t.geoPointValue.latitude||0,o=t.geoPointValue.longitude||0;return new kh(new Jc(i,o))}if(tf(t,n,"bytesValue")){Xl(t.bytesValue,"bytesValue");var a=this.fromBlob(t.bytesValue);return new Ah(a)}if(tf(t,n,"referenceValue")){Xl(t.referenceValue,"referenceValue");var s=this.fromResourceName(t.referenceValue),u=new nh(s.get(1),s.get(3)),c=new sh(this.extractLocalPathFromResourceName(s));return new Nh(u,c)}return fc("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return pc(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new ch(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=Oh.EMPTY;return Ec(n,function(t,n){r=r.set(new ah([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){pc(!!t.found,"Tried to deserialize a found document from a missing document."),Xl(t.found.name,"doc.found.name"),Xl(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new ch(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){pc(!!t.missing,"Tried to deserialize a missing document from a found document."),pc(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new hh(e,n)},t.prototype.fromMaybeDocument=function(t){var e=t.result;return tf(t,e,"found")?this.fromFound(t):tf(t,e,"missing")?this.fromMissing(t):fc("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case Pl.Added:return"ADD";case Pl.Current:return"CURRENT";case Pl.NoChange:return"NO_CHANGE";case Pl.Removed:return"REMOVE";case Pl.Reset:return"RESET";default:return fc("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof Vl)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Bl){if(t.newDoc instanceof ch){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof hh){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Ul){var n=void 0;return t.cause&&(n={code:bl(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return fc("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=t.response_type;if(tf(t,n,"targetChange")){Xl(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new Ul(r,i,o,s||null)}else if(tf(t,n,"documentChange")){Xl(t.documentChange,"documentChange"),Xl(t.documentChange.document,"documentChange.name"),Xl(t.documentChange.document.name,"documentChange.document.name"),Xl(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=this.fromFields(u.document.fields||{}),f=new ch(c,h,l,{},u.document),p=u.targetIds||[],d=u.removedTargetIds||[];e=new Bl(p,d,f.key,f)}else if(tf(t,n,"documentDelete")){Xl(t.documentDelete,"documentDelete"),Xl(t.documentDelete.document,"documentDelete.document");var m=t.documentDelete;c=this.fromName(m.document),h=m.readTime?this.fromVersion(m.readTime):Yh.forDeletedDoc(),f=new hh(c,h),d=m.removedTargetIds||[];e=new Bl([],d,f.key,f)}else if(tf(t,n,"documentRemove")){Xl(t.documentRemove,"documentRemove"),Xl(t.documentRemove.document,"documentRemove");var y=t.documentRemove;c=this.fromName(y.document),d=y.removedTargetIds||[];e=new Bl([],d,c,null)}else{if(!tf(t,n,"filter"))return fc("Unknown change type "+JSON.stringify(t));Xl(t.filter,"filter"),Xl(t.filter.targetId,"filter.targetId");var g=t.filter,v=g.count||0,b=new yl(v),w=g.targetId;e=new Vl(w,b)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?Pl.NoChange:"ADD"===t?Pl.Added:"REMOVE"===t?Pl.Removed:"CURRENT"===t?Pl.Current:"RESET"===t?Pl.Reset:fc("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!tf(t,t.response_type,"targetChange"))return Yh.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Yh.MIN:e.readTime?this.fromVersion(e.readTime):Yh.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof al)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof cl)e={delete:this.toName(t.key)};else if(t instanceof sl)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof ul))return fc("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):il.NONE;if(t.update){Xl(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new sl(r,i,o,n)}return new al(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new cl(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return pc(!0===n.exists,'Transforms only support precondition "exists == true"'),new ul(r,a)}return fc("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return pc(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:fc("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?il.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?il.exists(t.exists):il.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new rl(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(pc(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof hl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ll)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof fl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof pl)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw fc("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=t.transform_type,r=null;if(tf(t,n,"setToServerValue"))pc("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),r=hl.instance;else if(tf(t,n,"appendMissingElements")){var i=t.appendMissingElements.values||[];r=new ll(i.map(function(t){return e.fromValue(t)}))}else if(tf(t,n,"removeAllFromArray")){i=t.removeAllFromArray.values||[];r=new fl(i.map(function(t){return e.fromValue(t)}))}else if(tf(t,n,"increment")){var o=this.fromValue(t.increment);pc(o instanceof wh,"NUMERIC_ADD transform requires a NumberValue"),r=new pl(o)}else fc("Unknown transform proto: "+JSON.stringify(t));var a=ah.fromServerFormat(t.fieldPath);return new nl(a,r)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;pc(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Bh.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(pc(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(pc(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){pc(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Bh(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case qh.Listen:return null;case qh.ExistenceFilterMismatch:return"existence-filter-mismatch";case qh.LimboResolution:return"limbo-document";default:return fc("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof jh?e.toRelationFilter(t):e.toUnaryFilter(t)});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromRelationFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):fc("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Wh(r,n)},t.prototype.toDirection=function(t){return $l[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Gh.ASCENDING;case"DESCENDING":return Gh.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Hl[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Uh.EQUAL;case"GREATER_THAN":return Uh.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Uh.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Uh.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Uh.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Uh.ARRAY_CONTAINS;case"OPERATOR_UNSPECIFIED":return fc("Unspecified relation");default:return fc("Unknown relation")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return ah.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new zh(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.toRelationFilter=function(t){return t instanceof jh?{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}:fc("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromRelationFilter=function(t){return new jh(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryFilter=function(t){return t instanceof Kh?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}}:t instanceof Qh?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}:fc("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return new Kh(e);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return new Qh(n);case"OPERATOR_UNSPECIFIED":return fc("Unspecified filter");default:return fc("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return ah.fromServerFormat(t)});return el.fromArray(e)},t}();function tf(t,e,n){return e===n||!e&&n in t}var ef=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){pc(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){pc(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){pc(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){pc(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){pc(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){pc(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),nf="Connection",rf={BatchGetDocuments:"batchGet",Commit:"commit"},of="gl-js/ fire/"+oc,af=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=of},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new ic;s.listenOnce(nc.COMPLETE,function(){try{switch(s.getLastErrorCode()){case ec.NO_ERROR:var e=s.getResponseJson();cc(nf,"XHR received:",JSON.stringify(e)),o(e);break;case ec.TIMEOUT:cc(nf,'RPC "'+t+'" timed out'),a(new gc(yc.DEADLINE_EXCEEDED,"Request time out"));break;case ec.HTTP_ERROR:var n=s.getStatus();cc(nf,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0?a(new gc(function(t){switch(t){case 200:return yc.OK;case 400:return yc.INVALID_ARGUMENT;case 401:return yc.UNAUTHENTICATED;case 403:return yc.PERMISSION_DENIED;case 404:return yc.NOT_FOUND;case 409:return yc.ABORTED;case 416:return yc.OUT_OF_RANGE;case 429:return yc.RESOURCE_EXHAUSTED;case 499:return yc.CANCELLED;case 500:return yc.UNKNOWN;case 501:return yc.UNIMPLEMENTED;case 503:return yc.UNAVAILABLE;case 504:return yc.DEADLINE_EXCEEDED;default:return t>=200&&t<300?yc.OK:t>=400&&t<500?yc.FAILED_PRECONDITION:t>=500&&t<600?yc.INTERNAL:yc.UNKNOWN}}(n),"Server responded with status "+s.getStatusText())):(cc(nf,'RPC "'+t+'" failed'),a(new gc(yc.UNAVAILABLE,"Connection failed.")));break;default:fc('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{cc(nf,'RPC "'+t+'" completed.')}});var u=JSON.stringify(e);cc(nf,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=tc(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),"object"==typeof navigator&&"ReactNative"===navigator.product||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");cc(nf,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),s=!1,u=!1,c=new ef({sendFn:function(t){u?cc(nf,"Not sending because WebChannel is closed:",t):(s||(cc(nf,"Opening WebChannel transport."),a.open(),s=!0),cc(nf,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),h=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(rc.EventType.OPEN,function(){u||cc(nf,"WebChannel transport opened.")}),h(rc.EventType.CLOSE,function(){u||(u=!0,cc(nf,"WebChannel transport closed"),c.callOnClose())}),h(rc.EventType.ERROR,function(t){u||(u=!0,cc(nf,"WebChannel transport errored:",t),c.callOnClose(new gc(yc.UNAVAILABLE,"The operation could not be completed")))}),h(rc.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];pc(!!e,"Got a webchannel message without data.");var n=e.error||e[0]&&e[0].error;if(n){cc(nf,"WebChannel received error:",n);var r=n.status,i=function(t){var e=ml[t];if(void 0!==e)return vl(e)}(r),o=n.message;void 0===i&&(i=yc.INTERNAL,o="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new gc(i,o)),a.close()}else cc(nf,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=rf[t];pc(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),sf=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new af(t))},t.prototype.newSerializer=function(t){return new Zl(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();dc.setPlatform(new sf);var uf,cf=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),hf=function(){return function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}}();!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection"}(uf||(uf={}));var lf=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new hf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new gc(yc.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),ff=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var e=this;this.verifyNotFailed();var n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw hc("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),pc(e>=0,"Attempted to schedule an operation with a negative delay of "+e),pc(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=lf.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&fc("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){pc(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){pc(t===uf.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==uf.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);pc(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),pf="",df="",mf="",yf="";function gf(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=bf(e)),e=vf(t.get(n),e);return bf(e)}function vf(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=pf+mf;break;case pf:n+=pf+yf;break;default:n+=o}}return n}function bf(t){return t+pf+df}function wf(t){var e=t.length;if(pc(e>=2,"Invalid path "+t),2===e)return pc(t.charAt(0)===pf&&t.charAt(1)===df,"Non-empty path "+t+" had length 2"),ih.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(pf,o);switch((a<0||a>n)&&fc('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case df:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case mf:i+=t.substring(o,a),i+="\0";break;case yf:i+=t.substring(o,a+1);break;default:fc('Invalid encoded resource path: "'+t+'"')}o=a+2}return new ih(r)}var Sf=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,pc(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&pc(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;pc(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&pc(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Nl())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Kc(this.mutations,t.mutations)&&Kc(this.baseMutations,t.baseMutations)},t}(),Ef=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){pc(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Dl(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),Tf=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&fc("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),If=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return pc(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Nf(t).iterate({index:sp.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=Af(n),Of(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=Af(e),Of(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=kf(t),a=Nf(t);return a.add({}).next(function(s){pc("number"==typeof s,"Auto-generated key is not a number");var u=new Sf(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=up.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,up.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return Tf.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Nf(t).get(e).next(function(t){return t?(pc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Tf.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this;return this.getMutationQueueMetadata(t).next(function(r){var i=e+1,o=IDBKeyRange.lowerBound([n.userId,i]),a=null;return Nf(t).iterate({index:sp.userMutationsIndex,range:o},function(t,e,r){e.userId===n.userId&&(pc(e.batchId>=i,"Should have found mutation after "+i),a=n.serializer.fromDbMutationBatch(e)),r.done()}).next(function(){return a})})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Nf(t).loadAll(sp.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=up.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return kf(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=wf(u);if(s===n.userId&&e.path.isEqual(h))return Nf(t).get(c).next(function(t){if(!t)throw fc("Dangling document-mutation reference found: "+r+" which points to "+c);pc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Zh(Qc),i=[];return e.forEach(function(e){var o=up.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=kf(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=wf(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),Tf.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;pc(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),pc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=up.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new Zh(Qc);return kf(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=wf(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Nf(t).get(e).next(function(t){if(null===t)throw fc("Dangling document-mutation reference found, which points to "+e);pc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Tf.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Df(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),Tf.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Tf.resolve();var r=IDBKeyRange.lowerBound(up.prefixForUser(e.userId)),i=[];return kf(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=wf(t[1]);i.push(o)}else r.done()}).next(function(){pc(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return Cf(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return Of(t).get(this.userId).next(function(t){return t||new ap(e.userId,-1,"")})},t}();function Cf(t,e,n){var r=up.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return kf(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2];o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function Df(t,e,n){var r=t.store(sp.store),i=t.store(up.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){pc(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=up.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Tf.waitFor(o).next(function(){return c})}function Af(t){return t instanceof Uint8Array?(pc("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Nf(t){return Lp.getStore(t,sp.store)}function kf(t){return Lp.getStore(t,up.store)}function Of(t){return Lp.getStore(t,ap.store)}var _f,Rf=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(_f||(_f={}));var Mf=function(){function t(t,e){this.generatorId=t,pc((t&Rf)===t,"Generator ID "+t+" contains more than "+Rf+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<Rf,t},t.prototype.after=function(t){return this.seek(t+(1<<Rf)),this.next()},t.prototype.seek=function(t){pc((t&Rf)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(_f.QueryCache,2)},t.forSyncEngine=function(){return new t(_f.SyncEngine)},t}(),Pf=function(){function t(t){this.db=t}return t.openOrCreate=function(e,n,r){return pc(t.isAvailable(),"IndexedDB not supported in current environment."),cc("SimpleDb","Opening database:",e),new Tf(function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){var n=e.target.result;i(new t(n))},a.onblocked=function(){o(new gc(yc.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new gc(yc.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(t){cc("SimpleDb",'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new Lf(a.transaction);r.createOrUpgrade(n,i,t.oldVersion,np).next(function(){cc("SimpleDb","Database upgrade to version "+np+" complete")})}}).toPromise()},t.delete=function(t){return cc("SimpleDb","Removing database:",t),qf(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var e=window.navigator.userAgent,n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_")[0]:"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.runTransaction=function(t,e,n){var r=Lf.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Tf.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),xf=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return qf(this.dbCursor.delete())},t}(),Lf=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new hf,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){e.completionDeferred.reject(t.target.error)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(cc("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return pc(!!e,"Object store not part of transaction: "+t),new Ff(e)},t}(),Ff=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(cc("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(cc("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),qf(n)},t.prototype.add=function(t){return cc("SimpleDb","ADD",this.store.name,t,t),qf(this.store.add(t))},t.prototype.get=function(t){var e=this;return qf(this.store.get(t)).next(function(n){return void 0===n&&(n=null),cc("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return cc("SimpleDb","DELETE",this.store.name,t),qf(this.store.delete(t))},t.prototype.count=function(){return cc("SimpleDb","COUNT",this.store.name),qf(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){cc("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new Tf(function(n,r){e.onerror=function(t){r(t.target.error)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new Tf(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new xf(i),a=e(i.primaryKey,i.value,o);if(a instanceof Tf){var s=a.catch(function(t){return o.done(),Tf.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return Tf.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(pc(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function qf(t){return new Tf(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){n(t.target.error)}})}var Bf=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Mf.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Yh.fromTimestamp(new Zc(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return jf(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Vf(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return pc(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Vf(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return Tf.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return Vf(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return Uf(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,Lp.getStore(n,mp.store)).put(mp.key,e);var n},t.prototype.saveQueryData=function(t,e){return Vf(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Vf(t).iterate({range:i,index:pp.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Qf(t);return e.forEach(function(e){var a=gf(e.path);i.push(o.put(new dp(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),Tf.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Qf(t);return Tf.forEach(e,function(e){var o=gf(e.path);return Tf.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Qf(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Qf(t),i=Nl();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=wf(t[1]),o=new sh(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=gf(e.path),r=IDBKeyRange.bound([n],[Gc(n)],!1,!0),i=0;return Qf(t).iterate({index:dp.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return Vf(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function Vf(t){return Lp.getStore(t,pp.store)}function Uf(t){return Pf.getStore(t,mp.store).get(mp.key).next(function(t){return pc(null!==t,"Missing metadata row."),t})}function jf(t){return Uf(t).next(function(t){return t.highestListenSequenceNumber})}function Qf(t){return Lp.getStore(t,dp.store)}var Kf=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Ec(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},t.prototype.isEmpty=function(){return Tc(this.inner)},t}(),Gf=function(){function t(){this.changes=Sl(),this.documentSizes=new Kf(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?Tf.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return pc(null!==this.changes,"Changes have already been applied."),this.changes},t}(),Wf="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",zf=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=Pf.getStore(t,vp.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(e.length>0){for(var i=Yf(t),o=Nl(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Jf(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(Xf(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return Tf.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=Yf(t),r=Jf(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Zf(t)}):Tf.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return Yf(t).get(Jf(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return Yf(t).get(Jf(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Zf(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=El();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=El(),i=new fh(sh.comparator);return this.forEachDbEntry(t,e,function(t,e){e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i=i.insert(t,Zf(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Tf.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Yf(t).iterate({range:r},function(t,e,r){for(var a=sh.fromSegments(t);o&&sh.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;pc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Il(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return Yf(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof ch&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;pc(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Nl(),r=Sl(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Xf(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return Tf.reject(new gc(yc.DATA_LOSS,Wf))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new hh(n,Yh.forDeletedDoc());r=r.insert(n,e)}))}),Tf.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Xf(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new Hf(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return $f(t).get(fp.key).next(function(t){return pc(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return $f(t).put(fp.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function $f(t){return Lp.getStore(t,fp.store)}var Hf=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return wi(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentCache.serializer.toDbRemoteDocument(n),a=e.documentSizes.get(t);pc(void 0!==a,"Attempting to change document "+t.toString()+" without having read it first");var s=Zf(o);r+=s-a,i.push({key:t,doc:o})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(Gf);function Yf(t){return Lp.getStore(t,lp.store)}function Xf(t){return Lp.getStore(t,vp.store)}function Jf(t){return t.path.toArray()}function Zf(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw fc("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var tp=function(){function t(){this.collectionParentIndex=new ep}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Tf.resolve()},t.prototype.getCollectionParents=function(t,e){return Tf.resolve(this.collectionParentIndex.getEntries(e))},t}(),ep=function(){function t(){this.index={}}return t.prototype.add=function(t){pc(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Zh(ih.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new Zh(ih.comparator)).toArray()},t}(),np=8,rp=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;pc(n<r&&n>=0&&r<=np,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(op.store)}(t),function(t){t.createObjectStore(ap.store,{keyPath:ap.keyPath}),t.createObjectStore(sp.store,{keyPath:sp.keyPath,autoIncrement:!0}).createIndex(sp.userMutationsIndex,sp.userMutationsKeyPath,{unique:!0}),t.createObjectStore(up.store)}(t),gp(t),function(t){t.createObjectStore(lp.store)}(t));var o=Tf.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(dp.store),t.deleteObjectStore(pp.store),t.deleteObjectStore(mp.store)}(t),gp(t)),o=o.next(function(){return function(t){var e=t.store(mp.store),n=new mp(0,0,Yh.MIN.toTimestamp(),0);return e.put(mp.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(sp.store).loadAll().next(function(n){t.deleteObjectStore(sp.store);var r=t.createObjectStore(sp.store,{keyPath:sp.keyPath,autoIncrement:!0});r.createIndex(sp.userMutationsIndex,sp.userMutationsKeyPath,{unique:!0});var i=e.store(sp.store),o=n.map(function(t){return i.put(t)});return Tf.waitFor(o)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(bp.store,{keyPath:bp.keyPath})}(t),function(t){t.createObjectStore(vp.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(fp.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&r>=8&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(lp.store).iterate(function(t,n){e+=Zf(n)}).next(function(){var n=new fp(e);return t.store(fp.store).put(fp.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(ap.store),r=t.store(sp.store);return n.loadAll().next(function(n){return Tf.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(sp.userMutationsIndex,i).next(function(r){return Tf.forEach(r,function(r){pc(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Df(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(dp.store),n=t.store(lp.store);return jf(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new ih(n),a=function(t){return[0,gf(t)]}(o);r.push(e.get(a).next(function(n){return n?Tf.resolve():function(n){return e.put(new dp(0,gf(n),t))}(o)}))}).next(function(){return Tf.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(yp.store,{keyPath:yp.keyPath});var n=e.store(yp.store),r=new ep,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:gf(i)})}};return e.store(lp.store).iterate({keysOnly:!0},function(t,e){var n=new ih(t);return i(n.popLast())}).next(function(){return e.store(up.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],wf(n));return i(r.popLast())})})},t}();var ip=function(){return function(t,e){this.seconds=t,this.nanoseconds=e}}(),op=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var ap=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),sp=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var up=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,gf(e)]},t.key=function(t,e,n){return[t,gf(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var cp=function(){return function(t,e){this.path=t,this.readTime=e}}(),hp=function(){return function(t,e){this.path=t,this.version=e}}(),lp=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),fp=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var pp=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),dp=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,pc(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),mp=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),yp=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function gp(t){t.createObjectStore(dp.store,{keyPath:dp.keyPath}).createIndex(dp.documentTargetsIndex,dp.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(pp.store,{keyPath:pp.keyPath}).createIndex(pp.queryTargetsIndexName,pp.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(mp.store)}var vp=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var bp=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var wp=[ap.store,sp.store,up.store,lp.store,pp.store,op.store,mp.store,dp.store].concat([bp.store,vp.store]).concat([fp.store]).concat([yp.store]),Sp=function(){function t(){this.collectionParentsCache=new ep}return t.prototype.addToCollectionParentIndex=function(t,e){if(pc(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){pc(e.length>=1,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Ep(t).put({collectionId:n,parent:gf(r)})}return Tf.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Gc(e),""],!1,!0);return Ep(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(wf(o.parent))}return n})},t}();function Ep(t){return Lp.getStore(t,yp.store)}var Tp=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=sh.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new hh(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=sh.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new lh(e,n)}return fc("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof ch){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new lp(null,null,e,n)}if(t instanceof hh){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new lp(null,new cp(r,i),null,n)}if(t instanceof lh){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new lp(new hp(r,i),null,null,!0)}return fc("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new ip(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Zc(t.seconds,t.nanoseconds);return Yh.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new sp(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Zc.fromMillis(t.localWriteTimeMs);return new Sf(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(gf(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=Nl(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new sh(wf(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Jh(e,t.targetId,qh.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){pc(qh.Listen===t.purpose,"Only queries with purpose "+qh.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(pc("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new pp(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Ip(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Qc(n,i);return 0===a?Qc(r,o):a}var Cp=function(){function t(t){this.maxElements=t,this.buffer=new Zh(Ip),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ip(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Dp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ap=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),Np=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){pc(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Ap.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;pc(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;cc("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(uf.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Fp)})},t}(),kp=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Tf.resolve(cf.INVALID);var r=new Cp(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Ap.COLLECTION_DISABLED?(cc("LruGarbageCollector","Garbage collection skipped; disabled"),Tf.resolve(Dp)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(cc("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Dp):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c,h=this;return o=Date.now(),this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>h.params.maximumSequenceNumbersToCollect?(cc("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,a=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){(c=Date.now(),sc()<=Ju.DEBUG)&&cc("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-o)+"ms\n\tDetermined least recently used "+r+" in "+(s-a)+"ms\n\tRemoved "+i+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-o)+"ms");return Tf.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Op=function(){return function(){}}(),_p="IndexedDbPersistence",Rp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Mp="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.",Pp="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",xp=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return wi(e,t),e}(Op),Lp=function(){function t(e,n,r,i,o,a,s){if(this.persistenceKey=e,this.clientId=n,this.queue=i,this.multiClientParams=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!t.isAvailable())throw new gc(yc.UNIMPLEMENTED,Pp);if(this.referenceDelegate=new Vp(this,a),this.dbName=e+t.MAIN_DATABASE,this.serializer=new Tp(o),this.document=r.document,this.allowTabSynchronization=void 0!==s,this.queryCache=new Bf(this.referenceDelegate,this.serializer),this.indexManager=new Sp,this.remoteDocumentCache=new zf(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new gc(yc.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof xp)return Pf.getStore(t.simpleDbTransaction,e);throw fc("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e,n,r,i,o,a){return Ei(this,void 0,void 0,function(){var s;return Ti(this,function(u){switch(u.label){case 0:return[4,(s=new t(e,n,r,i,o,a)).start()];case 1:return u.sent(),[2,s]}})})},t.createMultiClientIndexedDbPersistence=function(e,n,r,i,o,a,s){return Ei(this,void 0,void 0,function(){var u;return Ti(this,function(c){switch(c.label){case 0:return[4,(u=new t(e,n,r,i,o,a,s)).start()];case 1:return c.sent(),[2,u]}})})},t.prototype.start=function(){var t=this;return pc(!this.started,"IndexedDbPersistence double-started!"),pc(null!==this.window,"Expected 'window' to be defined"),Pf.openOrCreate(this.dbName,np,new rp(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[mp.store],function(e){return jf(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new cf(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",wp,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Ei(e,void 0,void 0,function(){return Ti(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return Ei(e,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",wp,function(e){return Bp(e).put(new bp(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return qp(t).get(op.key).next(function(t){return Tf.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return Bp(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return Ei(this,void 0,void 0,function(){var e,n,r=this;return Ti(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,bp.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return Tf.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(uf.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return qp(t).get(op.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new gc(yc.FAILED_PRECONDITION,Mp);return!1}}return!(!e.networkEnabled||!e.inForeground)||Bp(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&cc(_p,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Ei(this,void 0,void 0,function(){var t=this;return Ti(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[op.store,bp.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[bp.store],function(e){return Bp(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},t.clearPersistence=function(e){return Ei(this,void 0,void 0,function(){var n;return Ti(this,function(r){switch(r.label){case 0:return t.isAvailable()?(n=e+t.MAIN_DATABASE,[4,Pf.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return pc(this.started,"Cannot initialize MutationQueue before persistence is started."),If.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getQueryCache=function(){return pc(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return pc(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return pc(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;return cc(_p,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",wp,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw hc("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new gc(yc.FAILED_PRECONDITION,Rp);return n(new xp(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new xp(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return qp(t).get(op.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new gc(yc.FAILED_PRECONDITION,Mp)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new op(this.clientId,this.allowTabSynchronization,Date.now());return qp(t).put(op.key,e)},t.isAvailable=function(){return Pf.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=qp(t);return n.get(op.key).next(function(t){return e.isLocalClient(t)?(cc(_p,"Releasing primary lease."),n.delete(op.key)):Tf.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(hc("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(pc(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(pc("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return cc(_p,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return hc(_p,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){hc("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Fp(t){return Ei(this,void 0,void 0,function(){return Ti(this,function(e){if(!function(t){return t.code===yc.FAILED_PRECONDITION&&t.message===Rp}(t))throw t;return cc(_p,"Unexpectedly lost primary lease"),[2]})})}function qp(t){return t.store(op.store)}function Bp(t){return t.store(bp.store)}var Vp=function(){function t(t,e){this.db=t,this.garbageCollector=new kp(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Up(t,e)},t.prototype.removeReference=function(t,e){return Up(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Up(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Tf.resolve(!0):function(t,e){var n=!1;return Of(t).iterateSerial(function(r){return Cf(t,r,e).next(function(t){return t&&(n=!0),Tf.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,a).next(function(t){i+=t})});o.push(u)}}).next(function(){return Tf.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return Tf.waitFor([Qf(t).delete((n=e,[0,gf(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Up(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=Qf(t),i=cf.INVALID;return r.iterate({index:dp.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==cf.INVALID&&e(new sh(wf(n)),i),i=s,n=a):i=cf.INVALID}).next(function(){i!==cf.INVALID&&e(new sh(wf(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Up(t,e){return Qf(t).put(function(t,e){return new dp(0,gf(t.path),e)}(e,t.currentSequenceNumber))}var jp=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=El();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Sl();return i.forEach(function(t,e){e||(e=new hh(t,Yh.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new sh(e)).next(function(t){var e=Il();return t instanceof ch&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;pc(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=Il();return this.indexManager.getCollectionParents(t,r).next(function(o){return Tf.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(i){return n=i,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(t){for(var r=0,i=t;r<i.length;r++)for(var o=i[r],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key;if(e.path.isImmediateParentOf(c.path)){var h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof ch?n.insert(c,l):n.remove(c)}}}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t}(),Qp=function(){function t(){this.refsByKey=new Zh(Kp.compareByKey),this.refsByTarget=new Zh(Kp.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new Kp(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new Kp(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=sh.EMPTY,r=new Kp(n,t),i=new Kp(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=sh.EMPTY,n=new Kp(e,t),r=new Kp(e,t+1),i=Nl();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Kp(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Kp=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return sh.comparator(t.key,e.key)||Qc(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return Qc(t.targetOrBatchId,e.targetOrBatchId)||sh.comparator(t.key,e.key)},t}(),Gp=function(){function t(t,e){this.persistence=t,this.localViewReferences=new Qp,this.queryDataByTarget={},pc(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new jp(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new jp(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=Nl(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];o.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++){f=y[m];a=a.add(f.key)}}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this,n=Zc.now(),r=t.reduce(function(t,e){return t.add(e.key)},Nl());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=r.get(u.key);if(!u.isIdempotent){var h=u.fieldMask;if(h){var l=c instanceof ch?h.applyTo(c.data):Oh.EMPTY;o.push(new sl(u.key,l,h,il.exists(!0)))}}}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):Tf.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return pc(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],a=Nl();Sc(e.targetChanges,function(r,s){var u=n.queryDataByTarget[r];if(u){s.addedDocuments.forEach(function(t){a=a.add(t)}),s.modifiedDocuments.forEach(function(t){a=a.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,s.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,s.addedDocuments,r)}));var c=s.resumeToken;if(c.length>0){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,s)&&o.push(n.queryCache.updateQueryData(i,u))}}});var s=Sl(),u=Nl();e.documentUpdates.forEach(function(t,e){u=u.add(t)}),o.push(r.getEntries(i,u).next(function(t){e.documentUpdates.forEach(function(u,c){var h=t.get(u);null==h||c.version.isEqual(Yh.MIN)||a.has(c.key)&&!h.hasPendingWrites||c.version.compareTo(h.version)>=0?(r.addEntry(c),s=s.insert(u,c)):cc("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(u)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))})}));var c=e.snapshotVersion;if(!c.isEqual(Yh.MIN)){var h=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return pc(c.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+c+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,c)});o.push(h)}return Tf.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,s)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0))},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Tf.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),Tf.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,Tf.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new Jh(t,i,qh.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return pc(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){pc(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?Tf.resolve():Tf.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Tf.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);pc(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):pc(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),Wp=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=mc(),this.batchesByDocumentKey=new Zh(Kp.compareByKey)}return t.prototype.checkEmpty=function(t){return Tf.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");pc(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return pc(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Tf.resolve()},t.prototype.getLastStreamToken=function(t){return Tf.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Tf.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){pc(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&pc(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Sf(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Kp(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Tf.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Tf.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return pc(null!=n,"Failed to find local mutation batch."),Tf.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Tf.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return Tf.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Kp(e,0),i=new Kp(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){pc(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);pc(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),Tf.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Zh(Qc);return e.forEach(function(t){var e=new Kp(t,0),i=new Kp(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){pc(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),Tf.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){pc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;sh.isDocumentKey(i)||(i=i.child(""));var o=new Kp(new sh(i),0),a=new Zh(Qc);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Tf.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;pc(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Tf.forEach(e.mutations,function(i){var o=new Kp(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new Kp(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Tf.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&pc(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Tf.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return pc(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return pc(n.batchId===t,"If found batch must match"),n},t}(),zp=function(){function t(t){this.persistence=t,this.queries=new Kf(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Yh.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Qp,this.targetCount=0,this.targetIdGenerator=Mf.forQueryCache()}return t.prototype.getTargetCount=function(t){return Tf.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),Tf.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Tf.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Tf.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Tf.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Tf.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return pc(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Tf.resolve()},t.prototype.updateQueryData=function(t,e){return pc(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Tf.resolve()},t.prototype.removeQueryData=function(t,e){return pc(this.targetCount>0,"Removing a target from an empty cache"),pc(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Tf.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),Tf.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return Tf.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Tf.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return fc("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),Tf.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),Tf.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Tf.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Tf.resolve(n)},t.prototype.containsKey=function(t,e){return Tf.resolve(this.references.containsKey(e))},t}();var $p,Hp=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new fh(sh.comparator),this.newDocumentChanges=Nl(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,Tf.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,Tf.resolve(n.size)):Tf.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Tf.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return Tf.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=El();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Tf.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=El(),i=new fh(sh.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),Tf.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){pc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Il(),r=new sh(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof ch&&e.matches(s)&&(n=n.insert(s.key,s))}return Tf.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return Tf.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=Sl();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new hh(t,Yh.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=Nl(),Tf.resolve(n)},t.prototype.newChangeBuffer=function(){return new Yp(this.sizer,this)},t.prototype.getSize=function(t){return Tf.resolve(this.size)},t}(),Yp=function(t){function e(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return wi(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentSizes.get(t);pc(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var a=e.sizer(n);r+=a-o,i.push({maybeDocument:n,size:a})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(Gf),Xp=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new cf(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new zp(this);this.indexManager=new tp,this.remoteDocumentCache=new Hp(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new td(t,new Tp(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new Zp(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Wp(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;cc("MemoryPersistence","Starting transaction:",t);var i=new Jp(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return Tf.or((n=this.mutationQueues,r=[],Ec(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),Jp=function(){return function(t){this.currentSequenceNumber=t}}(),Zp=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Tf.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Tf.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Tf.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return Tf.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?Tf.resolve():n.removeEntry(t,r).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return Tf.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Tf.resolve(n.inMemoryPins.containsKey(e))}])},t}(),td=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new Kf(function(t){return gf(t.path)}),this.garbageCollector=new kp(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return Tf.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Tf.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?Tf.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?Tf.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Tf.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Tf.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Tf.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Tf.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw fc("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return Tf.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Tf.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Tf.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),ed=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&cc("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}($p||($p={}));var nd,rd,id=1e3,od=6e4,ad=1.5,sd=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=$p.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new ed(t,e,id,ad,od)}return t.prototype.isStarted=function(){return this.state===$p.Starting||this.state===$p.Open||this.state===$p.Backoff},t.prototype.isOpen=function(){return this.state===$p.Open},t.prototype.start=function(){this.state!==$p.Error?(pc(this.state===$p.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close($p.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){pc(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=$p.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){return this.isOpen()?[2,this.close($p.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return Ei(this,void 0,void 0,function(){return Ti(this,function(n){switch(n.label){case 0:return pc(this.isStarted(),"Only started streams should be closed."),pc(t===$p.Error||Lh(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==$p.Error?this.backoff.reset():e&&e.code===yc.RESOURCE_EXHAUSTED?(hc(e.toString()),hc("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===yc.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;pc(this.state===$p.Initial,"Must be in initial state to auth"),this.state=$p.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new gc(yc.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;pc(this.state===$p.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return pc(e.state===$p.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=$p.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;pc(this.state===$p.Error,"Should only perform backoff when in Error state"),this.state=$p.Backoff,this.backoff.backoffAndRun(function(){return Ei(t,void 0,void 0,function(){return Ti(this,function(t){return pc(this.state===$p.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=$p.Initial,this.start(),pc(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return pc(this.isStarted(),"Can't handle server close on non-started stream"),cc("PersistentStream","close with error: "+t),this.stream=null,this.close($p.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(cc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),ud=function(t){function e(e,n,r,i,o){var a=t.call(this,e,uf.ListenStreamConnectionBackoff,uf.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return wi(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(sd),cd=function(t){function e(e,n,r,i,o){var a=t.call(this,e,uf.WriteStreamConnectionBackoff,uf.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a}return wi(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(pc(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return pc(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){pc(this.isOpen(),"Writing handshake requires an opened stream"),pc(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;pc(this.isOpen(),"Writing mutations requires an opened stream"),pc(this.handshakeComplete_,"Handshake must be complete before writing mutations"),pc(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(sd),hd=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new cd(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new ud(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=Sl();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);pc(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===yc.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===yc.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),ld=function(){function t(t){this.datastore=t,this.readVersions=Dl(),this.mutations=[],this.committed=!1}return t.prototype.recordVersion=function(t){var e;if(t instanceof ch)e=t.version;else{if(!(t instanceof hh))throw fc("Document in a transaction was a "+t.constructor.name);e=Yh.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new gc(yc.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.lookup=function(t){var e=this;return this.committed?Promise.reject("Transaction has already completed."):this.mutations.length>0?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof hh||t instanceof ch?e.recordVersion(t):fc("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.write=function(t){if(this.committed)throw new gc(yc.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(t)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return e?il.updateTime(e):il.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(e&&e.isEqual(Yh.forDeletedDoc()))throw new gc(yc.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return e?il.updateTime(e):il.exists(!0)},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t)))},t.prototype.update=function(t,e){this.write(e.toMutations(t,this.preconditionForUpdate(t)))},t.prototype.delete=function(t){this.write([new cl(t,this.precondition(t))]),this.readVersions=this.readVersions.insert(t,Yh.forDeletedDoc())},t.prototype.commit=function(){var t=this,e=this.readVersions;return this.mutations.forEach(function(t){e=e.remove(t.key)}),e.isEmpty()?this.datastore.commit(this.mutations).then(function(){t.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(nd||(nd={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(rd||(rd={}));var fd=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=nd.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(nd.Unknown),pc(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(uf.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,pc(t.state===nd.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(nd.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===nd.Online?(this.setAndBroadcast(nd.Unknown),pc(0===this.watchStreamFailures,"watchStreamFailures must be 0"),pc(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(nd.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===nd.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(hc(e),this.shouldWarnClientIsOffline=!1):cc("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),pd=function(){function t(t,e,n,r){this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new fd(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return Ei(this,void 0,void 0,function(){var t;return Ti(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(nd.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(nd.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(cc("RemoteStore","Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return cc("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(nd.Unknown),[2]}})})},t.prototype.listen=function(t){pc(!bc(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){pc(bc(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Tc(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(nd.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){pc(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new Ql(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Tc(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return Ei(this,void 0,void 0,function(){var t=this;return Ti(this,function(e){return Sc(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return Ei(this,void 0,void 0,function(){return Ti(this,function(e){return void 0===t&&pc(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(nd.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return Ei(this,void 0,void 0,function(){var n;return Ti(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(nd.Online),t instanceof Ul&&t.state===Pl.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof Bl?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Vl?this.watchChangeAggregator.handleExistenceFilter(t):(pc(t instanceof Ul,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Yh.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;pc(!t.isEqual(Yh.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return Sc(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:mc()}),e.sendUnwatchRequest(t);var r=new Jh(n.query,t,qh.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;pc(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return Ei(e,void 0,void 0,function(){return Ti(this,function(e){return bc(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return Ei(this,void 0,void 0,function(){var t,e;return Ti(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){pc(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){pc(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Fp)},t.prototype.onMutationResult=function(t,e){var n=this;pc(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Ef.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return Ei(this,void 0,void 0,function(){var e=this;return Ti(this,function(n){return void 0===t&&pc(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(t){return Ei(this,void 0,void 0,function(){return Ti(this,function(e){return gl(t.code)?(cc("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=mc(),[2,this.localStore.setLastStreamToken(mc()).catch(Fp)]):[2]})})},t.prototype.handleWriteError=function(t){return Ei(this,void 0,void 0,function(){var e,n=this;return Ti(this,function(r){return gl(i=t.code)&&i!==yc.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new ld(this.datastore)},t.prototype.handleCredentialChange=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(cc("RemoteStore","RemoteStore restarting streams for new credential"),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return t.sent(),this.onlineStateTracker.set(nd.Unknown),[4,this.enableNetwork()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.applyPrimaryState=function(t){return Ei(this,void 0,void 0,function(){return Ti(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(nd.Unknown),e.label=4;case 4:return[2]}})})},t}(),dd=function(){return function(){this.listeners=[]}}(),md=function(){function t(t){this.syncEngine=t,this.queries=new Kf(function(t){return t.canonicalId()}),this.onlineState=nd.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new dd,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return Ei(this,void 0,void 0,function(){var e,n,r,i;return Ti(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++){s[a].onViewSnapshot(r)}o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++){i[r].applyOnlineStateChange(t)}})},t}(),yd=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=nd.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(pc(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==_l.Metadata&&e.push(i)}t=new Ll(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(pc(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==nd.Offline;return this.options.waitForSyncWhenOnline&&n?(pc(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===nd.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){pc(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Ll.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),gd=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=Nl(),i=Nl(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case _l.Added:r=r.add(s.doc.key);break;case _l.Removed:i=i.add(s.doc.key)}}return new t(e,r,i)},t}(),vd=function(){return function(t){this.key=t}}(),bd=function(){return function(t){this.key=t}}(),wd=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Nl(),this.mutatedKeys=Nl(),this.documentSet=new Ml(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new xl,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof ch?e:null;h&&(pc(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:_l.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:_l.Modified,doc:h}),p=!0,u&&n.query.docComparator(h,u)>0&&(s=!0)):!c&&h?(r.track({type:_l.Added,doc:h}),p=!0):c&&!h&&(r.track({type:_l.Removed,doc:c}),p=!0,u&&(s=!0));p&&(h?(a=a.add(h),o=f?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:_l.Removed,doc:c})}return pc(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;pc(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case _l.Added:return 1;case _l.Modified:case _l.Metadata:return 2;case _l.Removed:return 0;default:return fc("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?Rl.Synced:Rl.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new Ll(this.query,t.documentSet,i,o,t.mutatedKeys,s===Rl.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===nd.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new xl,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return pc(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Nl(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new bd(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new vd(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Nl();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return Ll.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Rl.Local)},t}();var Sd=function(){return function(t,e,n){this.query=t,this.targetId=e,this.view=n}}(),Ed=function(){return function(t){this.key=t}}(),Td=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Kf(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new fh(sh.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new Qp,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Mf.forSyncEngine(),this.isPrimary=void 0,this.onlineState=nd.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){pc(null!==t,"SyncEngine listener cannot be null"),pc(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return Ei(this,void 0,void 0,function(){var e,n,r,i,o;return Ti(this,function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){var n=this,r=t.query;return this.localStore.executeQuery(r).then(function(i){return n.localStore.remoteDocumentKeys(t.targetId).then(function(o){var a=new wd(r,o),s=a.computeDocChanges(i),u=ql.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&n.onlineState!==nd.Offline),c=a.applyChanges(s,!0===n.isPrimary,u);pc(0===c.limboChanges.length,"View returned limbo docs before target ack from the server."),pc(!!c.snapshot,"applyChanges for new view should always return a snapshot");var h=new Sd(r,t.targetId,a);return n.queryViewsByQuery.set(r,h),n.queryViewsByTarget[t.targetId]=h,c.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){var e=this;return this.localStore.executeQuery(t.query).then(function(n){return e.localStore.remoteDocumentKeys(t.targetId).then(function(r){return Ei(e,void 0,void 0,function(){var e;return Ti(this,function(i){return e=t.view.synchronizeWithPersistedState(n,r),this.isPrimary&&this.updateTrackedLimbos(t.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(t){return Ei(this,void 0,void 0,function(){var e,n=this;return Ti(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),pc(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Fp)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(t,e){var n=this;void 0===e&&(e=5),pc(e>=0,"Got negative number of retries for transaction.");var r=this.remoteStore.createTransaction();return function(){try{var e=t(r);return!Lh(e)&&e.catch&&e.then?e.catch(function(t){return Promise.reject(n.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(t){return Promise.reject(n.wrapUpdateFunctionError(t))}}().then(function(i){return r.commit().then(function(){return i}).catch(function(r){return 0===e?Promise.reject(r):n.runTransaction(t,e-1)})})},t.prototype.applyRemoteEvent=function(t){var e=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(t).then(function(n){return Ec(t.targetChanges,function(t,n){var r=e.limboResolutionsByTarget[t];r&&(pc(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),n.addedDocuments.size>0?r.receivedDocument=!0:n.modifiedDocuments.size>0?pc(r.receivedDocument,"Received change for limbo target document without add."):n.removedDocuments.size>0&&(pc(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),e.emitNewSnapsAndNotifyLocalStore(n,t)}).catch(Fp)},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===rd.RemoteStore||!this.isPrimary&&e===rd.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);pc(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return Ei(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return Ti(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new fh(sh.comparator)).insert(r,new hh(r,Yh.forDeletedDoc())),o=Nl().add(r),a=new Fl(Yh.MIN,{},new Zh(Qc),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return pc(!!(s=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(s.query,!1).then(function(){return u.removeAndCleanupQuery(s)}).catch(Fp)];case 2:c.sent(),this.syncEngineListener.onWatchError(s.query,e),c.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return Ei(this,void 0,void 0,function(){var r;return Ti(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(cc("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):fc("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(Fp)},t.prototype.rejectFailedWrite=function(t,e){var n=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.localStore.rejectBatch(t).then(function(r){return n.sharedClientState.updateMutationState(t,"rejected",e),n.emitNewSnapsAndNotifyLocalStore(r)}).catch(Fp)},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new fh(Qc)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(pc(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof vd)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof bd){cc("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else fc("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){cc("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Bh.atPath(e.path);this.limboResolutionsByTarget[n]=new Ed(e),this.remoteStore.listen(new Jh(r,n,qh.LimboResolution,cf.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Ei(this,void 0,void 0,function(){var n,r,i,o=this;return Ti(this,function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=gd.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){pc(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return Ei(this,void 0,void 0,function(){var e,n;return Ti(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return Ei(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return Ti(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Sc(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;Sc(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new fh(sh.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){for(var e=this,n=Promise.resolve(),r=[],i=[],o=function(t){n=n.then(function(){return Ei(e,void 0,void 0,function(){var e,n,o,a;return Ti(this,function(s){switch(s.label){case 0:return(n=this.queryViewsByTarget[t])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return s.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=s.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(o=s.sent()).snapshot&&i.push(o.snapshot),[3,8];case 4:return pc(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(t)];case 5:return pc(!!(a=s.sent()),"Query data for target "+t+" not found"),[4,this.localStore.allocateQuery(a)];case 6:return e=s.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:s.sent(),s.label=8;case 8:return r.push(e),[2]}})})})},a=0,s=t;a<s.length;a++){o(s[a])}return n.then(function(){return e.syncEngineListener.onWatchChange(i),r})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return Ei(this,void 0,void 0,function(){var r,i=this;return Ti(this,function(o){switch(o.label){case 0:if(this.isPrimary)return cc("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,5];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return Ei(i,void 0,void 0,function(){var r;return Ti(this,function(i){switch(i.label){case 0:return r=Fl.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 1:return i.sent(),[2]}})})},function(t){return Ei(i,void 0,void 0,function(){var e;return Ti(this,function(n){switch(n.label){case 0:return function(t){return t.code===yc.DATA_LOSS&&t.message===Wf}(t)?(e=[],Sc(this.queryViewsByTarget,function(t){return e.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e)]):[3,2];case 1:return n.sent(),[3,3];case 2:throw t;case 3:return[2]}})})})];case 2:return r=this.queryViewsByTarget[t],this.removeAndCleanupQuery(r),[4,this.localStore.releaseQuery(r.query,!0)];case 3:return o.sent(),this.syncEngineListener.onWatchError(r.query,n),[3,5];case 4:fc("Unexpected target state: "+e),o.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(t,e){return Ei(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l=this;return Ti(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],pc(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return pc(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return Ti(this,function(n){switch(n.label){case 0:return(e=s.queryViewsByTarget[t])?[4,s.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(Fp)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},s=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,a(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Nl().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Nl()},t}(),Id=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Cd="SharedClientState",Dd="firestore_clients",Ad="firestore_mutations",Nd="firestore_targets",kd="firestore_online_state",Od="firestore_sequence_number",_d=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,pc(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new gc(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(hc(Cd,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Rd=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,pc(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new gc(r.error.code,r.error.message)),i?new t(e,r.state,o):(hc(Cd,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Md=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ol(),a=0;i&&a<r.activeTargetIds.length;++a)i=Fh(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(hc(Cd,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Pd=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&void 0!==nd[n.onlineState]&&"string"==typeof n.clientId?new t(n.clientId,nd[n.onlineState]):(hc(Cd,"Failed to parse online state: "+e),null)},t}(),xd=function(){function t(){this.activeTargetIds=Ol()}return t.prototype.addQueryTarget=function(t){pc(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ld=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new gc(yc.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=Od+"_"+r,this.activeClients[this.localClientId]=new xd,this.clientStateKeyRe=new RegExp("^"+Dd+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Ad+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+Nd+"_"+a+"_(\\d+)$"),this.onlineStateKey=kd+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return Ei(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,h,l=this;return Ti(this,function(f){switch(f.label){case 0:return pc(!this.started,"WebStorageSharedClientState already started"),pc(null!==this.syncEngine,"syncEngine property must be set before calling start()"),pc(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=Md.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Ol();return Ec(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=Rd.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return cc(Cd,"READ",t,e),e},t.prototype.setItem=function(t,e){cc(Cd,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){cc(Cd,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(cc(Cd,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void hc("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return Ei(e,void 0,void 0,function(){var e,n,r,i,o,a;return Ti(this,function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(pc(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=cf.INVALID;if(null!=t)try{var n=JSON.parse(t);pc("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){hc(Cd,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==cf.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new _d(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:nd[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new Rd(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return pc(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Dd+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return Nd+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=Ad+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return pc(null!==n,"Cannot parse client state key '"+t+"'"),Md.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);pc(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return _d.fromWebStorageEntry(new Id(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);pc(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Rd.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return Pd.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return Ei(this,void 0,void 0,function(){return Ti(this,function(e){return t.user.uid!==this.currentUser.uid?(cc(Cd,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return Ei(n,void 0,void 0,function(){return Ti(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return Ei(n,void 0,void 0,function(){return Ti(this,function(e){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var Fd=function(){function t(){this.localState=new xd,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new xd,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),qd=function(){function t(t,e){this.cacheSizeBytes=t,this.experimentalTabSynchronization=e}return t.prototype.lruParams=function(){return Ap.withCacheSize(this.cacheSizeBytes)},t}(),Bd=function(){return function(){}}(),Vd=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=jc.newId(),this.isShutdown=!1}return t.prototype.start=function(t){var e=this;this.verifyNotShutdown();var n=new hf,r=new hf,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof qd?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline storage. Falling back to storage disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof gc?t.code===yc.FAILED_PRECONDITION||t.code===yc.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code)},t.prototype.verifyNotShutdown=function(){if(this.isShutdown)throw new gc(yc.FAILED_PRECONDITION,"The client has already been shutdown.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=Lp.buildStoragePrefix(this.databaseInfo),i=new Zl(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return Ei(n,void 0,void 0,function(){var n,o;return Ti(this,function(a){switch(a.label){case 0:if(e.experimentalTabSynchronization&&!Ld.isAvailable(this.platform))throw new gc(yc.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.experimentalTabSynchronization?(this.sharedClientState=new Ld(this.asyncQueue,this.platform,r,this.clientId,t),[4,Lp.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=a.sent(),[3,4];case 2:return this.sharedClientState=new Fd,[4,Lp.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=a.sent(),a.label=4;case 4:return this.persistence=n,[2,n.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=Xp.createEagerPersistence(this.clientId),this.sharedClientState=new Fd,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return cc("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return Ei(n,void 0,void 0,function(){var n,i,o,a,s=this;return Ti(this,function(u){switch(u.label){case 0:return this.localStore=new Gp(this.persistence,t),e&&(this.lruScheduler=new Np(e,this.asyncQueue,this.localStore)),n=this.platform.newSerializer(this.databaseInfo.databaseId),i=new hd(this.asyncQueue,r,this.credentials,n),o=function(t){return s.syncEngine.applyOnlineStateChange(t,rd.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,rd.SharedClientState)},this.remoteStore=new pd(this.localStore,i,this.asyncQueue,o),this.syncEngine=new Td(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new md(this.syncEngine),[4,this.sharedClientState.start()];case 1:return u.sent(),[4,this.remoteStore.start()];case 2:return u.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return Ei(s,void 0,void 0,function(){return Ti(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return u.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),cc("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(){var t=this;return!0===this.isShutdown?Promise.resolve():this.asyncQueue.enqueue(function(){return Ei(t,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),this.isShutdown=!0,[2]}})})})},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new yd(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof ch)return t;if(t instanceof hh)return null;throw new gc(yc.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=Nl(),r=new wd(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new hf;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return Ei(e,void 0,void 0,function(){return Ti(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),Ud=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),jd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Uc(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Nc("FieldPath","string",n,t[n]),0===t[n].length)throw new gc(yc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ah(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bc("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(ah.keyField().canonicalString()),t}(),Qd=new RegExp("[~\\*/\\[\\]]");var Kd=function(){return function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}}}(),Gd=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){pc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(Id.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){pc(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Wd=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;pc(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new gc(yc.ABORTED,"getToken aborted due to token change.");return n?(pc("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new Kd(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){pc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){pc(null!=this.tokenListener,"removeChangeListener() called twice"),pc(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return pc(null===t||"string"==typeof t,"Received invalid UID: "+t),new Id(t)},t}(),zd=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Id.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),$d=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new zd(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(Id.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Hd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var Yd,Xd=function(){function t(t){this._methodName=t}return t.delete=function(){return Ic("FieldValue.delete",arguments),Jd.instance},t.serverTimestamp=function(){return Ic("FieldValue.serverTimestamp",arguments),Zd.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Dc("FieldValue.arrayUnion",arguments,1),new tm(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Dc("FieldValue.arrayRemove",arguments,1),new em(t)},t.increment=function(t){return Nc("FieldValue.increment","number",1,t),Cc("FieldValue.increment",arguments,1),new nm(t)},t.prototype.isEqual=function(t){return this===t},t}(),Jd=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return wi(e,t),e.instance=new e,e}(Xd),Zd=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return wi(e,t),e.instance=new e,e}(Xd),tm=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return wi(e,t),e}(Xd),em=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return wi(e,t),e}(Xd),nm=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return wi(e,t),e}(Xd),rm=vc(Xd,"Use FieldValue.<field>() instead."),im=/^__.*__$/,om=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new sl(t,this.data,this.fieldMask,e)):n.push(new al(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new ul(t,this.fieldTransforms)),n},t}(),am=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new sl(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new ul(t,this.fieldTransforms)),n},t}();function sm(t){switch(t){case Yd.Set:case Yd.MergeSet:case Yd.Update:return!0;case Yd.Argument:return!1;default:throw fc("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument"}(Yd||(Yd={}));var um=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new gc(yc.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(sm(this.dataSource)&&im.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),cm=function(){return function(t,e){this.databaseId=t,this.key=e}}(),hm=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new um(Yd.Set,t,ah.EMPTY_PATH);fm("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new om(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new um(Yd.MergeSet,t,ah.EMPTY_PATH);fm("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Zh(ah.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof jd)l=h._internalPath;else{if("string"!=typeof h)throw fc("Expected stringOrFieldPath to be a string or a FieldPath");l=dm(t,h)}if(!r.contains(l))throw new gc(yc.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=el.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=el.fromArray(r.fieldMask),o=r.fieldTransforms;return new om(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new um(Yd.Update,t,ah.EMPTY_PATH);fm("Data must be an object, but it was:",r,e);var i=new Zh(ah.comparator),o=Oh.EMPTY;Ec(e,function(e,a){var s=dm(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof Jd)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=el.fromSet(i);return new am(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new um(Yd.Update,t,ah.EMPTY_PATH),o=[pm(t,e)],a=[n];if(r.length%2!=0)throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(pm(t,r[s])),a.push(r[s+1]);var u=new Zh(ah.comparator),c=Oh.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof Jd)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=el.fromSet(u);return new am(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new um(Yd.Argument,t,ah.EMPTY_PATH),r=this.parseData(e,n);return pc(null!=r,"Parsed data should not be null."),pc(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=mm(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(lm(t=this.runPreConverter(t,e)))return fm("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof Xd)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new fh(Qc);return Tc(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ec(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Oh(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=vh.INSTANCE),n.push(s),r++}return new _h(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!sm(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Jd){if(e.dataSource!==Yd.MergeSet)throw e.dataSource===Yd.Update?(pc(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Zd)e.fieldTransforms.push(new nl(e.path,hl.instance));else if(t instanceof tm){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new ll(n);e.fieldTransforms.push(new nl(e.path,r))}else if(t instanceof em){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new fl(n);e.fieldTransforms.push(new nl(e.path,i))}else if(t instanceof nm){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new pl(o);e.fieldTransforms.push(new nl(e.path,a))}else fc("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return vh.INSTANCE;if("number"==typeof t)return Fh(t)?new Eh(t):new Th(t);if("boolean"==typeof t)return bh.of(t);if("string"==typeof t)return new Ih(t);if(t instanceof Date)return new Ch(Zc.fromDate(t));if(t instanceof Zc)return new Ch(new Zc(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Jc)return new kh(t);if(t instanceof Yc)return new Ah(t);if(t instanceof cm)return new Nh(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Lc(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new um(Yd.Argument,t,ah.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function lm(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Zc||t instanceof Jc||t instanceof Yc||t instanceof cm||t instanceof Xd)}function fm(t,e,n){if(!lm(n)||!xc(n)){var r=Lc(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function pm(t,e){if(e instanceof jd)return e._internalPath;if("string"==typeof e)return dm(t,e);throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function dm(t,e){try{return function(t){if(t.search(Qd)>=0)throw new gc(yc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(jd.bind.apply(jd,[void 0].concat(t.split("."))))}catch(e){throw new gc(yc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=mm(e);throw new gc(yc.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function mm(t){return t instanceof Error?t.message:t.toString()}var ym="firestore.googleapis.com",gm=!0,vm=!0,bm=!1,wm=Ap.COLLECTION_DISABLED,Sm=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new gc(yc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ym,this.ssl=gm}else Oc("settings","non-empty string","host",t.host),this.host=t.host,_c("settings","boolean","ssl",t.ssl),this.ssl=wc(t.ssl,gm);if(qc("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),_c("settings","object","credentials",t.credentials),this.credentials=t.credentials,_c("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?hc("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&hc("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=wc(t.timestampsInSnapshots,vm),_c("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ap.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==wm&&t.cacheSizeBytes<Ap.MINIMUM_CACHE_SIZE_BYTES)throw new gc(yc.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ap.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}_c("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?bm:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),Em=function(){return function(){}}(),Tm=function(){function t(e){var n=this;this._queue=new ff,this.INTERNAL={delete:function(){return Ei(n,void 0,void 0,function(){return Ti(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),this.clientRunning=!1,[2]}})})}},this.clientRunning=!1;var r=new Em;if("object"==typeof e.options){var i=e;r.firebaseApp=i,r.databaseId=t.databaseIdFromApp(i),r.persistenceKey=r.firebaseApp.name,r.credentials=new Wd(i)}else{var o=e;if(!o.projectId)throw new gc(yc.INVALID_ARGUMENT,"Must provide projectId");r.databaseId=new nh(o.projectId,o.database),r.persistenceKey="[DEFAULT]",r.credentials=new Gd}r.settings=new Sm({}),this._config=r,this._databaseId=r.databaseId}return t.prototype.settings=function(t){if(Cc("Firestore.settings",arguments,1),Nc("Firestore.settings","object",1,t),bc(t,"persistence"))throw new gc(yc.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Sm(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new gc(yc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=e,void 0!==e.credentials&&(this._config.credentials=function(t){if(!t)return new Gd;switch(t.type){case"gapi":var e=t.client;return pc(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new $d(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new gc(yc.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new gc(yc.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(new qd(this._config.settings.cacheSizeBytes,void 0!==t&&wc(t.experimentalTabSynchronization,!1)))},t.prototype._clearPersistence=function(){if(this.clientRunning)throw new gc(yc.FAILED_PRECONDITION,"Persistence cannot be cleared while the client is running");var t=Lp.buildStoragePrefix(this.makeDatabaseInfo());return Lp.clearPersistence(t)},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Bd),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new th(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)},t.prototype.configureClient=function(t){var e=this;pc(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),pc(!this._firestoreClient,"configureClient() called multiple times"),this.clientRunning=!0;var n=this.makeDatabaseInfo();return this._dataConverter=new hm(function(t){if(t instanceof Dm){var n=e._config.databaseId,r=t.firestore._config.databaseId;if(!r.isEqual(n))throw new gc(yc.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new cm(e._config.databaseId,t._key)}return t}),this._firestoreClient=new Vd(dc.getPlatform(),n,this._config.credentials,this._queue),this._firestoreClient.start(t)},t.databaseIdFromApp=function(t){var e=t.options;if(!bc(e,"projectId"))throw new gc(yc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new gc(yc.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new nh(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new gc(yc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return Cc("Firestore.collection",arguments,1),Nc("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Rm(ih.fromString(t),this)},t.prototype.doc=function(t){return Cc("Firestore.doc",arguments,1),Nc("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),Dm.forPath(ih.fromString(t),this)},t.prototype._collectionGroup=function(t){if(Cc("Firestore.collectionGroup",arguments,1),Nc("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new gc(yc.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Om(new Bh(ih.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return Cc("Firestore.runTransaction",arguments,1),Nc("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new Im(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Cm(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(sc()){case Ju.DEBUG:return"debug";case Ju.ERROR:return"error";case Ju.SILENT:return"silent";default:return fc("Unknown log level: "+sc())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(Cc("Firestore.setLogLevel",arguments,1),Nc("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":uc(Ju.DEBUG);break;case"error":uc(Ju.ERROR);break;case"silent":uc(Ju.SILENT);break;default:throw new gc(yc.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},t}(),Im=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;Cc("Transaction.get",arguments,1);var n=Lm("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return fc("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof hh)return new Nm(e._firestore,n._key,null,!1,!1);if(r instanceof ch)return new Nm(e._firestore,n._key,r,!1,!1);throw fc("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){Ac("Transaction.set",arguments,2,3);var r=Lm("Transaction.set",t,this._firestore),i=(n=Mm("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof jd?(Dc("Transaction.update",arguments,3),r=Lm("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Cc("Transaction.update",arguments,2),r=Lm("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Cc("Transaction.delete",arguments,1);var e=Lm("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Cm=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){Ac("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Lm("WriteBatch.set",t,this._firestore),i=(n=Mm("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,il.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof jd?(Dc("WriteBatch.update",arguments,3),r=Lm("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Cc("WriteBatch.update",arguments,2),r=Lm("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,il.exists(!0))),this},t.prototype.delete=function(t){Cc("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Lm("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new cl(e._key,il.NONE)),this},t.prototype.commit=function(){return Ei(this,void 0,void 0,function(){return Ti(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new gc(yc.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Dm=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new gc(yc.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new sh(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Rm(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(Cc("DocumentReference.collection",arguments,1),Nc("DocumentReference.collection","non-empty string",1,t),!t)throw new gc(yc.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ih.fromString(t);return new Rm(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bc("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){Ac("DocumentReference.set",arguments,1,2);var n=(e=Mm("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,il.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof jd?(Dc("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Cc("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,il.exists(!0)))},t.prototype.delete=function(){return Cc("DocumentReference.delete",arguments,0),this._firestoreClient.write([new cl(this._key,il.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ac("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Hd(t[i])||(qc("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),_c("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return Hd(t[i])?n=t[i]:(Nc("DocumentReference.onSnapshot","function",i,t[i]),kc("DocumentReference.onSnapshot","function",i+1,t[i+1]),kc("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Ud({next:function(t){if(e.next){pc(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Nm(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Bh.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return Ac("DocumentReference.get",arguments,0,1),xm("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new Nm(e.firestore,e._key,t,!0,t instanceof ch&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new gc(yc.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new gc(yc.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),Am=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Nm=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return Ac("DocumentSnapshot.data",arguments,0,1),t=Pm("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,yh.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(Ac("DocumentSnapshot.get",arguments,1,2),e=Pm("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(pm("DocumentSnapshot.get",t));if(void 0!==n)return this.convertValue(n,yh.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Dm(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Am(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bc("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof Oh)return this.convertObject(t,e);if(t instanceof _h)return this.convertArray(t,e);if(t instanceof Nh){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||hc("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Dm(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),km=function(t){function e(e,n,r,i,o){return t.call(this,e,n,r,i,o)||this}return wi(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return pc("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Nm),Om=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){Cc("Query.where",arguments,3),Fc("Query.where",3,r);var i;!function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new gc(yc.INVALID_ARGUMENT,"Invalid value "+Lc(r)+" provided to function "+t+"() for its "+Vc(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,n);var o=pm("Query.where",e),a=Uh.fromString(n);if(o.isKeyField()){if(a===Uh.ARRAY_CONTAINS)throw new gc(yc.INVALID_ARGUMENT,"Invalid Query. You can't perform array-contains queries on FieldPath.documentId() since document IDs are not arrays.");if("string"==typeof r){if(""===r)throw new gc(yc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==r.indexOf("/"))throw new gc(yc.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection by FieldPath.documentId(), the value provided must be a plain document ID, but '"+r+"' contains a slash.");var s=this._query.path.child(ih.fromString(r));if(!sh.isDocumentKey(s))throw new gc(yc.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+s+"' is not because it has an odd number of segments ("+s.length+").");i=new Nh(this.firestore._databaseId,new sh(s))}else{if(!(r instanceof Dm))throw new gc(yc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+Lc(r)+".");var u=r;i=new Nh(this.firestore._databaseId,u._key)}}else i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var c=Vh.create(o,a,i);return this.validateNewFilter(c),new t(this._query.addFilter(c),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(Ac("Query.orderBy",arguments,1,2),kc("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=Gh.ASCENDING;else{if("desc"!==n)throw new gc(yc.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=Gh.DESCENDING}if(null!==this._query.startAt)throw new gc(yc.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new gc(yc.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=pm("Query.orderBy",e),o=new zh(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(Cc("Query.limit",arguments,1),Nc("Query.limit","number",1,e),e<=0)throw new gc(yc.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dc("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dc("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dc("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Dc("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bc("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(Fc(t,1,e),e instanceof Nm){if(n.length>0)throw new gc(yc.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new gc(yc.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Nh(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Dh)throw new gc(yc.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(void 0===s){var u=a.field.canonicalString();throw new gc(yc.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new Wh(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new gc(yc.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new gc(yc.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new gc(yc.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(ih.fromString(a));if(!sh.isDocumentKey(s))throw new gc(yc.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new sh(s);i.push(new Nh(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new Wh(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ac("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Hd(t[i])||(qc("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),_c("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),Hd(t[i])?n=t[i]:(Nc("Query.onSnapshot","function",i,t[i]),kc("Query.onSnapshot","function",i+1,t[i+1]),kc("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Ud({next:function(t){e.next&&e.next(new _m(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.get=function(t){var e=this;return Ac("Query.get",arguments,0,1),xm("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new _m(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new gc(yc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.validateNewFilter=function(t){if(t instanceof jh)if(t.isInequality()){var e=this._query.getInequalityFilterField();if(null!==e&&!e.isEqual(t.field))throw new gc(yc.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+e.toString()+"' and '"+t.field.toString()+"'");var n=this._query.getFirstOrderByField();null!==n&&this.validateOrderByAndInequalityMatch(t.field,n)}else if(t.op===Uh.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new gc(yc.INVALID_ARGUMENT,"Invalid query. Queries only support a single array-contains filter.")},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new gc(yc.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),_m=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Am(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Ac("QuerySnapshot.forEach",arguments,1,2),Nc("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Om(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(qc("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),_c("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new gc(yc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new km(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return pc(e.type===_l.Added,"Invalid event type for first snapshot"),pc(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==_l.Metadata}).map(function(e){var r=new km(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==_l.Added&&(pc((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==_l.Removed&&(o=o.add(e.doc),a=o.indexOf(e.doc.key)),{type:Fm(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Bc("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new km(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(_m.prototype.docChanges,t,{get:function(){return function(){throw new gc(yc.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Rm=function(t){function e(e,n){var r=t.call(this,Bh.atPath(e),n)||this;if(e.length%2!=1)throw new gc(yc.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return wi(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new Dm(new sh(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(Ac("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=jc.newId()),Nc("CollectionReference.doc","non-empty string",1,t),""===t)throw new gc(yc.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=ih.fromString(t);return Dm.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){Cc("CollectionReference.add",arguments,1),Nc("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(Om);function Mm(t,e){if(void 0===e)return{merge:!1};if(qc(t,e,["merge","mergeFields"]),_c(t,"boolean","merge",e.merge),Rc(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof jd}),void 0!==e.mergeFields&&void 0!==e.merge)throw new gc(yc.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Pm(t,e){return void 0===e?{}:(qc(t,e,["serverTimestamps"]),Mc(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function xm(t,e){kc(t,"object",1,e),e&&(qc(t,e,["source"]),Mc(t,0,"source",e.source,["default","server","cache"]))}function Lm(t,e,n){if(e instanceof Dm){if(e.firestore!==n)throw new gc(yc.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Bc(t,"DocumentReference",1,e)}function Fm(t){switch(t){case _l.Added:return"added";case _l.Modified:case _l.Metadata:return"modified";case _l.Removed:return"removed";default:return fc("Unknown change type: "+t)}}var qm=vc(Tm,"Use firebase.firestore() instead."),Bm=vc(Im,"Use firebase.firestore().runTransaction() instead."),Vm=vc(Cm,"Use firebase.firestore().batch() instead."),Um=vc(Dm,"Use firebase.firestore().doc() instead."),jm=vc(Nm),Qm=vc(km),Km=vc(Om),Gm=vc(_m),Wm=vc(Rm,"Use firebase.firestore().collection() instead."),zm={Firestore:qm,GeoPoint:Jc,Timestamp:Zc,Blob:Xc,Transaction:Bm,WriteBatch:Vm,DocumentReference:Um,DocumentSnapshot:jm,Query:Km,QueryDocumentSnapshot:Qm,QuerySnapshot:Gm,CollectionReference:Wm,FieldPath:jd,FieldValue:rm,setLogLevel:Tm.setLogLevel,CACHE_SIZE_UNLIMITED:wm};function $m(t){t.INTERNAL.registerService("firestore",function(t){return new Tm(t)},function(t){pc(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(zm))}!function(t){$m(t)}(Ki);Ki.initializeApp({apiKey:"AIzaSyDiyZi8l5GhhUdl-Sr6vhLVVFz1LBFWl7Y",authDomain:"wds-feedback.firebaseapp.com",databaseURL:"https://wds-feedback.firebaseio.com",projectId:"wds-feedback",storageBucket:"wds-feedback.appspot.com",messagingSenderId:"18319457375",appId:"1:18319457375:web:81e870a0759d7d1e"});const Hm="responses2019";const Ym=function(){const t=function(){const t=new Date,e=new Date(t.getFullYear(),0,0),n=t-e+60*(e.getTimezoneOffset()-t.getTimezoneOffset())*1e3;return`${Math.floor(n/864e5)}`}(),e=Ki.firestore().collection(Hm).doc(t),n=t=>async n=>{try{await e.update({[t]:Ki.firestore.FieldValue.arrayUnion(n)})}catch(r){await e.set({[t]:n})}};return{saveRating:n("ratings"),saveSuggestion:n("suggestions")}}();function Xm(t,e,n){const r=Object.create(t);return r.rating=e[n],r}function Jm(t){var e,n,r,i,o;function a(){return t.click_handler(t)}return{c(){e=S("span"),n=E("svg"),r=E("polygon"),i=I(),D(r,"points","12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"),D(n,"xmlns","http://www.w3.org/2000/svg"),D(n,"width","24"),D(n,"height","24"),D(n,"viewBox","0 0 24 24"),D(n,"stroke","currentColor"),D(n,"stroke-width","2"),D(n,"stroke-linecap","round"),D(n,"stroke-linejoin","round"),D(n,"class","feather feather-star svelte-1bl19n9"),A(n,"selected",t.rating<=t.selected),o=C(e,"click",a)},m(t,o){b(t,e,o),v(e,n),v(n,r),v(e,i)},p(e,r){t=r,(e.ratings||e.selected)&&A(n,"selected",t.rating<=t.selected)},d(t){t&&w(e),o()}}}function Zm(e){for(var n,r=e.ratings,i=[],o=0;o<r.length;o+=1)i[o]=Jm(Xm(e,r,o));return{c(){n=S("div");for(var t=0;t<i.length;t+=1)i[t].c()},m(t,e){b(t,n,e);for(var r=0;r<i.length;r+=1)i[r].m(n,null)},p(t,e){if(t.ratings||t.selected){r=e.ratings;for(var o=0;o<r.length;o+=1){const a=Xm(e,r,o);i[o]?i[o].p(t,a):(i[o]=Jm(a),i[o].c(),i[o].m(n,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},i:t,o:t,d(t){t&&w(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(i,t)}}}function ty(t,e,n){let r=0;async function i(t){n("selected",r=t),await Ym.saveRating(t),lt.actions.rate(t)}return{ratings:[1,2,3,4,5],selected:r,rate:i,click_handler:function({rating:t}){return i(t)}}}class ey extends tt{constructor(t){super(),Z(this,t,ty,Zm,s,[])}}function ny(e){var n;return{c(){(n=S("div")).className="loading svelte-mro4x1"},m(t,e){b(t,n,e)},p:t,i:t,o:t,d(t){t&&w(n)}}}class ry extends tt{constructor(t){super(),Z(this,t,null,ny,s,[])}}var iy="Expected a function",oy=NaN,ay="[object Symbol]",sy=/^\s+|\s+$/g,uy=/^[-+]0x[0-9a-f]+$/i,cy=/^0b[01]+$/i,hy=/^0o[0-7]+$/i,ly=parseInt,fy="object"==typeof Tt&&Tt&&Tt.Object===Object&&Tt,py="object"==typeof self&&self&&self.Object===Object&&self,dy=fy||py||Function("return this")(),my=Object.prototype.toString,yy=Math.max,gy=Math.min,vy=function(){return dy.Date.now()};function by(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function wy(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&my.call(t)==ay}(t))return oy;if(by(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=by(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(sy,"");var n=cy.test(t);return n||hy.test(t)?ly(t.slice(2),n?2:8):uy.test(t)?oy:+t}var Sy=function(t,e,n){var r,i,o,a,s,u,c=0,h=!1,l=!1,f=!0;if("function"!=typeof t)throw new TypeError(iy);function p(e){var n=r,o=i;return r=i=void 0,c=e,a=t.apply(o,n)}function d(t){var n=t-u;return void 0===u||n>=e||n<0||l&&t-c>=o}function m(){var t=vy();if(d(t))return y(t);s=setTimeout(m,function(t){var n=e-(t-u);return l?gy(n,o-(t-c)):n}(t))}function y(t){return s=void 0,f&&r?p(t):(r=i=void 0,a)}function g(){var t=vy(),n=d(t);if(r=arguments,i=this,u=t,n){if(void 0===s)return function(t){return c=t,s=setTimeout(m,e),h?p(t):a}(u);if(l)return s=setTimeout(m,e),p(u)}return void 0===s&&(s=setTimeout(m,e)),a}return e=wy(e)||0,by(n)&&(h=!!n.leading,o=(l="maxWait"in n)?yy(wy(n.maxWait)||0,e):o,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},g.flush=function(){return void 0===s?a:y(vy())},g};function Ey(e){var n,r,i,o=new gt({});return{c(){n=S("div"),o.$$.fragment.c()},m(t,e){b(t,n,e),X(o,n,null),i=!0},p:t,i(t){i||(o.$$.fragment.i(t),r||U(()=>{(r=Y(n,nt,{duration:1e3,delay:200})).start()}),i=!0)},o(t){o.$$.fragment.o(t),i=!1},d(t){t&&w(n),o.$destroy()}}}function Ty(t){var e,n=new Et({props:{$$slots:{default:[ky],header:[Dy]},$$scope:{ctx:t}}});return{c(){n.$$.fragment.c()},m(t,r){X(n,t,r),e=!0},p(t,e){var r={};(t.$$scope||t.$store||t.text)&&(r.$$scope={changed:t,ctx:e}),n.$set(r)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function Iy(t){var e,n=new Et({props:{$$slots:{default:[_y],header:[Oy]},$$scope:{ctx:t}}});return{c(){n.$$.fragment.c()},m(t,r){X(n,t,r),e=!0},p(t,e){var r={};t.$$scope&&(r.$$scope={changed:t,ctx:e}),n.$set(r)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function Cy(t){var e,n=new Et({props:{$$slots:{default:[My],header:[Ry]},$$scope:{ctx:t}}});return{c(){n.$$.fragment.c()},m(t,r){X(n,t,r),e=!0},p(t,e){var r={};t.$$scope&&(r.$$scope={changed:t,ctx:e}),n.$set(r)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function Dy(t){var e;return{c(){(e=S("h1")).textContent="Tell us what to fix",D(e,"slot","header")},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Ay(e){var n;return{c(){(n=S("button")).textContent="Submit",n.className="svelte-1wa4yrj"},m(t,e){b(t,n,e)},i:t,o:t,d(t){t&&w(n)}}}function Ny(t){var e,n=new ry({});return{c(){n.$$.fragment.c()},m(t,r){X(n,t,r),e=!0},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function ky(t){var e,n,r,i,a,s,u,c,h,l=[Ny,Ay],f=[];function p(t){return t.$store.submitting?0:1}return s=p(t),u=f[s]=l[s](t),{c(){var o;e=I(),n=S("form"),r=S("textarea"),a=I(),u.c(),r.disabled=i=t.$store.submitting,r.className="svelte-1wa4yrj",n.className="svelte-1wa4yrj",h=[C(r,"input",t.textarea_input_handler),C(n,"submit",(o=t.onSubmit,function(t){return t.preventDefault(),o.call(this,t)}))]},m(i,o){b(i,e,o),b(i,n,o),v(n,r),r.value=t.text,v(n,a),f[s].m(n,null),c=!0},p(t,e){t.text&&(r.value=e.text),c&&!t.$store||i===(i=e.$store.submitting)||(r.disabled=i);var o=s;(s=p(e))!==o&&(z(),H(()=>{f[o].d(1),f[o]=null}),u.o(1),$(),(u=f[s])||(u=f[s]=l[s](e)).c(),u.i(1),u.m(n,null))},i(t){c||(u&&u.i(),c=!0)},o(t){u&&u.o(),c=!1},d(t){t&&(w(e),w(n)),f[s].d(),o(h)}}}function Oy(t){var e;return{c(){(e=S("h1")).textContent="Thanks",D(e,"slot","header")},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function _y(e){return{c:t,m:t,p:t,d:t}}function Ry(t){var e;return{c(){(e=S("h1")).textContent="Rate this site",D(e,"slot","header")},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function My(e){var n,r,i=new ey({});return{c(){n=I(),i.$$.fragment.c()},m(t,e){b(t,n,e),X(i,t,e),r=!0},p:t,i(t){r||(i.$$.fragment.i(t),r=!0)},o(t){i.$$.fragment.o(t),r=!1},d(t){t&&w(n),i.$destroy(t)}}}function Py(t){var e,n,r,i,o,a,s=[Cy,Iy,Ty,Ey],u=[];function c(t){return t.isHidden||t.thanks||t.form?t.thanks?1:t.form?2:3:0}return i=c(t),o=u[i]=s[i](t),{c(){e=S("link"),n=I(),r=S("aside"),o.c(),e.href="https://fonts.googleapis.com/css?family=Special+Elite",e.rel="stylesheet",r.id="site-feedback-widget-container"},m(t,o){v(document.head,e),b(t,n,o),b(t,r,o),u[i].m(r,null),a=!0},p(t,e){var n=i;(i=c(e))===n?u[i].p(t,e):(z(),H(()=>{u[n].d(1),u[n]=null}),o.o(1),$(),(o=u[i])||(o=u[i]=s[i](e)).c(),o.i(1),o.m(r,null))},i(t){a||(o&&o.i(),a=!0)},o(t){o&&o.o(),a=!1},d(t){w(e),t&&(w(n),w(r)),u[i].d()}}}function xy(t,e,n){let r,i;c(t,lt,t=>{n("$store",r=t)}),c(t,ft,t=>{n("$hide",i=t)});let{feedbackOffset:o=700,autoOpen:a=!0,autoOpenDelay:s=8e3}=e,u="";const h={capture:!0,passive:!0},l=Sy(t=>{window.pageYOffset;!f||r.init||i||lt.actions.show()},s);let f,p,d;return P(()=>(!i&&document.addEventListener("scroll",l,h),()=>document.removeEventListener("scroll",l,listerConfig))),t.$set=(t=>{"feedbackOffset"in t&&n("feedbackOffset",o=t.feedbackOffset),"autoOpen"in t&&n("autoOpen",a=t.autoOpen),"autoOpenDelay"in t&&n("autoOpenDelay",s=t.autoOpenDelay)}),t.$$.update=((t={$store:1,thanks:1})=>{t.$store&&n("isHidden",f="idle"===r.current),t.$store&&n("thanks",p="thanks"===r.current),t.thanks&&p&&setTimeout(()=>lt.actions.close(),3e3),t.$store&&n("form",d="form"===r.current)}),{feedbackOffset:o,autoOpen:a,autoOpenDelay:s,text:u,onSubmit:async function(){lt.actions.submit(u),await Ym.saveSuggestion(u),lt.actions.finish("ok"),n("text",u="")},isHidden:f,$store:r,thanks:p,form:d,textarea_input_handler:function(){u=this.value,n("text",u)}}}class Ly extends tt{constructor(t){super(),Z(this,t,xy,Py,u,["feedbackOffset","autoOpen","autoOpenDelay"])}}window.site_feedback_widget=function(t){return new Ly({target:document.getElementById("site-feedback-widget"),props:{...t,feedbackOffset:700,autoOpen:!0}})}}();
//# sourceMappingURL=sfw-bundle.js.map
